<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007ba5; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #007ba5; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #007ba5; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #5e5e5e; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>

<style>
  div.csl-bib-body { }
  div.csl-entry {
    clear: both;
    }
  .hanging div.csl-entry {
    margin-left:2em;
    text-indent:-2em;
  }
  div.csl-left-margin {
    min-width:2em;
    float:left;
  }
  div.csl-right-inline {
    margin-left:2em;
    padding-left:1em;
  }
  div.csl-indent {
    margin-left: 2em;
  }
</style>

  <!--radix_placeholder_meta_tags-->
<title>The R Journal: Finding Optimal Normalizing Transformations via bestNormalize</title>

<meta property="description" itemprop="description" content="The bestNormalize R package was designed to help users find a transformation that can effectively normalize a vector regardless of its actual distribution. Each of the many normalization techniques that have been developed has its own strengths and weaknesses, and deciding which to use until data are fully observed is difficult or impossible. This package facilitates choosing between a range of possible transformations and will automatically return  the best one, i.e., the one that makes data look the *most* normal. To evaluate and compare  the normalization efficacy across a suite of possible transformations, we developed a  statistic based on a goodness of fit test divided by its degrees of freedom.  Transformations can be seamlessly trained and applied to newly observed data  and can be implemented in conjunction with caret and recipes for  data preprocessing in machine learning workflows. Custom transformations and  normalization statistics are supported."/>

<link rel="canonical" href="https://doi.org/10.32614/RJ-2021-041/"/>
<link rel="license" href="https://creativecommons.org/licenses/by/4.0/"/>
<link rel="icon" type="image/vnd.microsoft.icon" href="../../resources/favicon.ico"/>

<!--  https://schema.org/Article -->
<meta property="article:published" itemprop="datePublished" content="2021-06-07"/>
<meta property="article:created" itemprop="dateCreated" content="2021-06-07"/>
<meta name="article:author" content="Ryan A. Peterson"/>

<!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
<meta property="og:title" content="The R Journal: Finding Optimal Normalizing Transformations via bestNormalize"/>
<meta property="og:type" content="article"/>
<meta property="og:description" content="The bestNormalize R package was designed to help users find a transformation that can effectively normalize a vector regardless of its actual distribution. Each of the many normalization techniques that have been developed has its own strengths and weaknesses, and deciding which to use until data are fully observed is difficult or impossible. This package facilitates choosing between a range of possible transformations and will automatically return  the best one, i.e., the one that makes data look the *most* normal. To evaluate and compare  the normalization efficacy across a suite of possible transformations, we developed a  statistic based on a goodness of fit test divided by its degrees of freedom.  Transformations can be seamlessly trained and applied to newly observed data  and can be implemented in conjunction with caret and recipes for  data preprocessing in machine learning workflows. Custom transformations and  normalization statistics are supported."/>
<meta property="og:url" content="https://doi.org/10.32614/RJ-2021-041/"/>
<meta property="og:image" content="https://rjournal-distill.netlify.app/articles/RJ-2021-041/feature.png"/>
<meta property="og:image:width" content="2033"/>
<meta property="og:image:height" content="1442"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:site_name" content="The R Journal"/>

<!--  https://dev.twitter.com/cards/types/summary -->
<meta property="twitter:card" content="summary_large_image"/>
<meta property="twitter:title" content="The R Journal: Finding Optimal Normalizing Transformations via bestNormalize"/>
<meta property="twitter:description" content="The bestNormalize R package was designed to help users find a transformation that can effectively normalize a vector regardless of its actual distribution. Each of the many normalization techniques that have been developed has its own strengths and weaknesses, and deciding which to use until data are fully observed is difficult or impossible. This package facilitates choosing between a range of possible transformations and will automatically return  the best one, i.e., the one that makes data look the *most* normal. To evaluate and compare  the normalization efficacy across a suite of possible transformations, we developed a  statistic based on a goodness of fit test divided by its degrees of freedom.  Transformations can be seamlessly trained and applied to newly observed data  and can be implemented in conjunction with caret and recipes for  data preprocessing in machine learning workflows. Custom transformations and  normalization statistics are supported."/>
<meta property="twitter:url" content="https://doi.org/10.32614/RJ-2021-041/"/>
<meta property="twitter:image" content="https://rjournal-distill.netlify.app/articles/RJ-2021-041/feature.png"/>
<meta property="twitter:image:width" content="2033"/>
<meta property="twitter:image:height" content="1442"/>

<!--  https://scholar.google.com/intl/en/scholar/inclusion.html#indexing -->
<meta name="citation_title" content="The R Journal: Finding Optimal Normalizing Transformations via bestNormalize"/>
<meta name="citation_fulltext_html_url" content="https://doi.org/10.32614/RJ-2021-041"/>
<meta name="citation_pdf_url" content="RJ-2021-041.pdf"/>
<meta name="citation_volume" content="13"/>
<meta name="citation_issue" content="1"/>
<meta name="citation_doi" content="10.32614/RJ-2021-041"/>
<meta name="citation_journal_title" content="{The R Journal}"/>
<meta name="citation_issn" content="2073-4859"/>
<meta name="citation_firstpage" content="310"/>
<meta name="citation_lastpage" content="329"/>
<meta name="citation_fulltext_world_readable" content=""/>
<meta name="citation_online_date" content="2021/06/07"/>
<meta name="citation_publication_date" content="2021/06/07"/>
<meta name="citation_author" content="Ryan A. Peterson"/>
<meta name="citation_author_institution" content="Department of Biostatistics and Informatics&#10;"/>
<!--/radix_placeholder_meta_tags-->
  
  <meta name="citation_reference" content="citation_title=An analysis of transformations;citation_publication_date=1964;citation_publisher=Royal Statistical Society, Wiley;citation_volume=26;citation_issn=00359246;citation_author=G. E. P. Box;citation_author=D. R. Cox"/>
  <meta name="citation_reference" content="citation_title=Exponential data transformations;citation_publication_date=1976;citation_publisher=[Royal Statistical Society, Wiley];citation_volume=25;citation_author=B. F. J. Manly"/>
  <meta name="citation_reference" content="citation_title=An alternative family of transformations;citation_publication_date=1980;citation_publisher=[Wiley, Royal Statistical Society];citation_volume=29;citation_author=J. A. John;citation_author=N. R. Draper"/>
  <meta name="citation_reference" content="citation_title=An analysis of transformations revisited;citation_publication_date=1981;citation_publisher=Taylor &amp; Francis;citation_volume=76;citation_author=Peter J. Bickel;citation_author=Kjell A. Doksum"/>
  <meta name="citation_reference" content="citation_title=Nortest: Tests for normality;citation_publication_date=2015;citation_author=Juergen Gross;citation_author=Uwe Ligges"/>
  <meta name="citation_reference" content="citation_title=Goodness-of-fit-techniques;citation_publication_date=1986;citation_publisher=CRC press;citation_volume=68;citation_author=Ralph B D’Agostino"/>
  <meta name="citation_reference" content="citation_title=Ordered quantile normalization: A semiparametric transformation built for the cross-validation era;citation_publication_date=2019;citation_publisher=Taylor &amp; Francis;citation_author=Ryan A. Peterson;citation_author=Joseph E. Cavanaugh"/>
  <meta name="citation_reference" content="citation_title=Testing for normality;citation_publication_date=2002;citation_publisher=CRC press;citation_volume=164;citation_author=Henry C Thode"/>
  <meta name="citation_reference" content="citation_title=doRNG: Generic reproducible parallel backend for ’foreach’ loops;citation_publication_date=2020;citation_author=Renaud Gaujoux"/>
  <meta name="citation_reference" content="citation_title=Tidymodels: Easily install and load the ’tidymodels’ packages;citation_publication_date=2020;citation_author=Max Kuhn;citation_author=Hadley Wickham"/>
  <meta name="citation_reference" content="citation_title=Estimating departure from normality;citation_publication_date=1991;citation_volume=10;citation_doi=https://doi.org/10.1002/sim.4780100811;citation_author=Patrick Royston"/>
  <meta name="citation_reference" content="citation_title=Yardstick: Tidy characterizations of model performance;citation_publication_date=2020;citation_author=Max Kuhn;citation_author=Davis Vaughan"/>
  <!--radix_placeholder_rmarkdown_metadata-->

<script type="text/json" id="radix-rmarkdown-metadata">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","author","description","keywords","draft","type","journal","volume","issue","citation_url","doi","slug","preamble","date","date_received","packages","CTV","creative_commons","always_allow_html","preview","output","bibliography","pdf_url","csl","canonical_url"]}},"value":[{"type":"character","attributes":{},"value":["Finding Optimal Normalizing Transformations via bestNormalize"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","affiliation","address","email","url"]}},"value":[{"type":"character","attributes":{},"value":["Ryan A. Peterson"]},{"type":"character","attributes":{},"value":["Department of Biostatistics and Informatics\n"]},{"type":"character","attributes":{},"value":["University of Colorado Anschutz Medical Campus 13001 East 17th Place Aurora, Colorado 80045  ORCID: 0000-0002-4650-5798\n"]},{"type":"character","attributes":{},"value":["\\email{ryan.a.peterson@cuanschutz.edu}"]},{"type":"character","attributes":{},"value":["https://petersonr.github.io/"]}]}]},{"type":"character","attributes":{},"value":["The bestNormalize R package was designed to help users find a transformation that can effectively normalize a vector regardless of its actual distribution. Each of the many normalization techniques that have been developed has its own strengths and weaknesses, and deciding which to use until data are fully observed is difficult or impossible. This package facilitates choosing between a range of possible transformations and will automatically return  the best one, i.e., the one that makes data look the *most* normal. To evaluate and compare  the normalization efficacy across a suite of possible transformations, we developed a  statistic based on a goodness of fit test divided by its degrees of freedom.  Transformations can be seamlessly trained and applied to newly observed data  and can be implemented in conjunction with caret and recipes for  data preprocessing in machine learning workflows. Custom transformations and  normalization statistics are supported."]},{"type":"character","attributes":{},"value":["preprocessing, caret, recipes, machine learning, normalization"]},{"type":"logical","attributes":{},"value":[false]},{"type":"character","attributes":{},"value":["package"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","issn","firstpage","lastpage"]}},"value":[{"type":"character","attributes":{},"value":["{The R Journal}"]},{"type":"character","attributes":{},"value":["2073-4859"]},{"type":"character","attributes":{},"value":["310"]},{"type":"character","attributes":{},"value":["329"]}]},{"type":"integer","attributes":{},"value":[13]},{"type":"integer","attributes":{},"value":[1]},{"type":"character","attributes":{},"value":["https://doi.org/10.32614/RJ-2021-041"]},{"type":"character","attributes":{},"value":["10.32614/RJ-2021-041"]},{"type":"character","attributes":{},"value":["RJ-2021-041"]},{"type":"character","attributes":{},"value":["\\usepackage{float} \\floatplacement{figure}{H}  \\floatplacement{table}{H} \\usepackage{lmodern}\n"]},{"type":"character","attributes":{},"value":["2021-06-07"]},{"type":"character","attributes":{},"value":["2020-06-03"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["cran","bioc"]}},"value":[{"type":"character","attributes":{},"value":["bestNormalize","caret","recipes","MASS","LambertW","nortest","parallel","doRNG","tidymodels","visreg","scales","ggplot2","mgcv","yardstick"]},{"type":"NULL"}]},{"type":"character","attributes":{},"value":["SocialSciences","Distributions","Econometrics","Environmetrics","HighPerformanceComputing","Multivariate","TeachingStatistics","Bayesian","Graphics","MachineLearning","NumericalMathematics","Phylogenetics","Psychometrics","Robust"]},{"type":"character","attributes":{},"value":["CC BY"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["feature.png"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained","toc"]}},"value":[{"type":"logical","attributes":{},"value":[false]},{"type":"logical","attributes":{},"value":[false]}]}]},{"type":"character","attributes":{},"value":["RJournal-final-submission.bib"]},{"type":"character","attributes":{},"value":["RJ-2021-041.pdf"]},{"type":"character","attributes":{},"value":["/home/mitchell/R/x86_64-pc-linux-gnu-library/4.1/rjtools/rjournal.csl"]},{"type":"character","attributes":{},"value":["https://doi.org/10.32614/RJ-2021-041/"]}]}
</script>
<!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["bestNormalize_1.8.0.tar.gz","feature.png","figs/bn_plot-1.pdf","figs/bn_plot-1.png","figs/bnplot-1.pdf","figs/bnplot-1.png","figs/boxplot-1.pdf","figs/boxplot-1.png","figs/gam_tbs_model-1.pdf","figs/gam_tbs_model-1.png","figs/gam-tbs-model-1.pdf","figs/gam-tbs-model-1.png","figs/hist_app-1.pdf","figs/hist_app-1.png","figs/hist_best-1.pdf","figs/hist_best-1.png","figs/hist_trans-1.pdf","figs/hist_trans-1.png","figs/histapp-1.pdf","figs/histapp-1.png","figs/histbest-1.pdf","figs/histbest-1.png","figs/histtrans-1.pdf","figs/histtrans-1.png","figs/linear_visreg-1.pdf","figs/linear_visreg-1.png","figs/linearvisreg-1.pdf","figs/linearvisreg-1.png","figs/orq_vis-1.pdf","figs/orq_vis-1.png","figs/orqvis-1.pdf","figs/orqvis-1.png","figs/parallel_timings.pdf","figs/simple_hist-1.pdf","figs/simple_hist-1.png","figs/simplehist-1.pdf","figs/simplehist-1.png","figs/vis_data2-1.pdf","figs/vis_data2-1.png","figs/visdata2-1.pdf","figs/visdata2-1.png","RJ-2021-041_files/anchor-4.2.2/anchor.min.js","RJ-2021-041_files/bowser-1.9.3/bowser.min.js","RJ-2021-041_files/distill-2.2.21/template.v2.js","RJ-2021-041_files/header-attrs-2.11/header-attrs.js","RJ-2021-041_files/header-attrs-2.12/header-attrs.js","RJ-2021-041_files/jquery-3.6.0/jquery-3.6.0.js","RJ-2021-041_files/jquery-3.6.0/jquery-3.6.0.min.js","RJ-2021-041_files/jquery-3.6.0/jquery-3.6.0.min.map","RJ-2021-041_files/kePrint-0.0.1/kePrint.js","RJ-2021-041_files/lightable-0.0.1/lightable.css","RJ-2021-041_files/popper-2.6.0/popper.min.js","RJ-2021-041_files/tippy-6.2.7/tippy-bundle.umd.min.js","RJ-2021-041_files/tippy-6.2.7/tippy-light-border.css","RJ-2021-041_files/tippy-6.2.7/tippy.css","RJ-2021-041_files/tippy-6.2.7/tippy.umd.min.js","RJ-2021-041_files/webcomponents-2.0.0/webcomponents.js","RJ-2021-041.pdf","RJ-2021-041.tex","RJournal-final-submission_files/anchor-4.2.2/anchor.min.js","RJournal-final-submission_files/bowser-1.9.3/bowser.min.js","RJournal-final-submission_files/distill-2.2.21/template.v2.js","RJournal-final-submission_files/header-attrs-2.9/header-attrs.js","RJournal-final-submission_files/jquery-1.11.3/jquery.min.js","RJournal-final-submission_files/kePrint-0.0.1/kePrint.js","RJournal-final-submission_files/lightable-0.0.1/lightable.css","RJournal-final-submission_files/popper-2.6.0/popper.min.js","RJournal-final-submission_files/tippy-6.2.7/tippy-bundle.umd.min.js","RJournal-final-submission_files/tippy-6.2.7/tippy-light-border.css","RJournal-final-submission_files/tippy-6.2.7/tippy.css","RJournal-final-submission_files/tippy-6.2.7/tippy.umd.min.js","RJournal-final-submission_files/webcomponents-2.0.0/webcomponents.js","RJournal-final-submission.bib","RJournal.sty","RJwrapper.log","RJwrapper.tex"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
<meta name="distill:offset" content="../.."/>

<script type="application/javascript">

  window.headroom_prevent_pin = false;

  window.document.addEventListener("DOMContentLoaded", function (event) {

    // initialize headroom for banner
    var header = $('header').get(0);
    var headerHeight = header.offsetHeight;
    var headroom = new Headroom(header, {
      tolerance: 5,
      onPin : function() {
        if (window.headroom_prevent_pin) {
          window.headroom_prevent_pin = false;
          headroom.unpin();
        }
      }
    });
    headroom.init();
    if(window.location.hash)
      headroom.unpin();
    $(header).addClass('headroom--transition');

    // offset scroll location for banner on hash change
    // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
    window.addEventListener("hashchange", function(event) {
      window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
    });

    // responsive menu
    $('.distill-site-header').each(function(i, val) {
      var topnav = $(this);
      var toggle = topnav.find('.nav-toggle');
      toggle.on('click', function() {
        topnav.toggleClass('responsive');
      });
    });

    // nav dropdowns
    $('.nav-dropbtn').click(function(e) {
      $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
      $(this).parent().siblings('.nav-dropdown')
         .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $("body").click(function(e){
      $('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $(".nav-dropdown").click(function(e){
      e.stopPropagation();
    });
  });
</script>

<style type="text/css">

/* Theme (user-documented overrideables for nav appearance) */

.distill-site-nav {
  color: rgba(255, 255, 255, 0.8);
  background-color: #0F2E3D;
  font-size: 15px;
  font-weight: 300;
}

.distill-site-nav a {
  color: inherit;
  text-decoration: none;
}

.distill-site-nav a:hover {
  color: white;
}

@media print {
  .distill-site-nav {
    display: none;
  }
}

.distill-site-header {

}

.distill-site-footer {

}


/* Site Header */

.distill-site-header {
  width: 100%;
  box-sizing: border-box;
  z-index: 3;
}

.distill-site-header .nav-left {
  display: inline-block;
  margin-left: 8px;
}

@media screen and (max-width: 768px) {
  .distill-site-header .nav-left {
    margin-left: 0;
  }
}


.distill-site-header .nav-right {
  float: right;
  margin-right: 8px;
}

.distill-site-header a,
.distill-site-header .title {
  display: inline-block;
  text-align: center;
  padding: 14px 10px 14px 10px;
}

.distill-site-header .title {
  font-size: 18px;
  min-width: 150px;
}

.distill-site-header .logo {
  padding: 0;
}

.distill-site-header .logo img {
  display: none;
  max-height: 20px;
  width: auto;
  margin-bottom: -4px;
}

.distill-site-header .nav-image img {
  max-height: 18px;
  width: auto;
  display: inline-block;
  margin-bottom: -3px;
}



@media screen and (min-width: 1000px) {
  .distill-site-header .logo img {
    display: inline-block;
  }
  .distill-site-header .nav-left {
    margin-left: 20px;
  }
  .distill-site-header .nav-right {
    margin-right: 20px;
  }
  .distill-site-header .title {
    padding-left: 12px;
  }
}


.distill-site-header .nav-toggle {
  display: none;
}

.nav-dropdown {
  display: inline-block;
  position: relative;
}

.nav-dropdown .nav-dropbtn {
  border: none;
  outline: none;
  color: rgba(255, 255, 255, 0.8);
  padding: 16px 10px;
  background-color: transparent;
  font-family: inherit;
  font-size: inherit;
  font-weight: inherit;
  margin: 0;
  margin-top: 1px;
  z-index: 2;
}

.nav-dropdown-content {
  display: none;
  position: absolute;
  background-color: white;
  min-width: 200px;
  border: 1px solid rgba(0,0,0,0.15);
  border-radius: 4px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
  z-index: 1;
  margin-top: 2px;
  white-space: nowrap;
  padding-top: 4px;
  padding-bottom: 4px;
}

.nav-dropdown-content hr {
  margin-top: 4px;
  margin-bottom: 4px;
  border: none;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.nav-dropdown-active {
  display: block;
}

.nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
  color: black;
  padding: 6px 24px;
  text-decoration: none;
  display: block;
  text-align: left;
}

.nav-dropdown-content .nav-dropdown-header {
  display: block;
  padding: 5px 24px;
  padding-bottom: 0;
  text-transform: uppercase;
  font-size: 14px;
  color: #999999;
  white-space: nowrap;
}

.nav-dropdown:hover .nav-dropbtn {
  color: white;
}

.nav-dropdown-content a:hover {
  background-color: #ddd;
  color: black;
}

.nav-right .nav-dropdown-content {
  margin-left: -45%;
  right: 0;
}

@media screen and (max-width: 768px) {
  .distill-site-header a, .distill-site-header .nav-dropdown  {display: none;}
  .distill-site-header a.nav-toggle {
    float: right;
    display: block;
  }
  .distill-site-header .title {
    margin-left: 0;
  }
  .distill-site-header .nav-right {
    margin-right: 0;
  }
  .distill-site-header {
    overflow: hidden;
  }
  .nav-right .nav-dropdown-content {
    margin-left: 0;
  }
}


@media screen and (max-width: 768px) {
  .distill-site-header.responsive {position: relative; min-height: 500px; }
  .distill-site-header.responsive a.nav-toggle {
    position: absolute;
    right: 0;
    top: 0;
  }
  .distill-site-header.responsive a,
  .distill-site-header.responsive .nav-dropdown {
    display: block;
    text-align: left;
  }
  .distill-site-header.responsive .nav-left,
  .distill-site-header.responsive .nav-right {
    width: 100%;
  }
  .distill-site-header.responsive .nav-dropdown {float: none;}
  .distill-site-header.responsive .nav-dropdown-content {position: relative;}
  .distill-site-header.responsive .nav-dropdown .nav-dropbtn {
    display: block;
    width: 100%;
    text-align: left;
  }
}

/* Site Footer */

.distill-site-footer {
  width: 100%;
  overflow: hidden;
  box-sizing: border-box;
  z-index: 3;
  margin-top: 30px;
  padding-top: 30px;
  padding-bottom: 30px;
  text-align: center;
}

/* Headroom */

d-title {
  padding-top: 6rem;
}

@media print {
  d-title {
    padding-top: 4rem;
  }
}

.headroom {
  z-index: 1000;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
}

.headroom--transition {
  transition: all .4s ease-in-out;
}

.headroom--unpinned {
  top: -100px;
}

.headroom--pinned {
  top: 0;
}

/* adjust viewport for navbar height */
/* helps vertically center bootstrap (non-distill) content */
.min-vh-100 {
  min-height: calc(100vh - 100px) !important;
}

</style>

<script src="../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="../../site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet"/>
<link href="../../site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet"/>
<script src="../../site_libs/headroom-0.9.4/headroom.min.js"></script>
<!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

<style type="text/css">

body {
  background-color: white;
}

.pandoc-table {
  width: 100%;
}

.pandoc-table>caption {
  margin-bottom: 10px;
}

.pandoc-table th:not([align]) {
  text-align: left;
}

.pagedtable-footer {
  font-size: 15px;
}

d-byline .byline {
  grid-template-columns: 2fr 2fr;
}

d-byline .byline h3 {
  margin-block-start: 1.5em;
}

d-byline .byline .authors-affiliations h3 {
  margin-block-start: 0.5em;
}

.authors-affiliations .orcid-id {
  width: 16px;
  height:16px;
  margin-left: 4px;
  margin-right: 4px;
  vertical-align: middle;
  padding-bottom: 2px;
}

d-title .dt-tags {
  margin-top: 1em;
  grid-column: text;
}

.dt-tags .dt-tag {
  text-decoration: none;
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0em 0.4em;
  margin-right: 0.5em;
  margin-bottom: 0.4em;
  font-size: 70%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

d-article table.gt_table td,
d-article table.gt_table th {
  border-bottom: none;
}

.html-widget {
  margin-bottom: 2.0em;
}

.l-screen-inset {
  padding-right: 16px;
}

.l-screen .caption {
  margin-left: 10px;
}

.shaded {
  background: rgb(247, 247, 247);
  padding-top: 20px;
  padding-bottom: 20px;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .html-widget {
  margin-bottom: 0;
  border: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .shaded-content {
  background: white;
}

.text-output {
  margin-top: 0;
  line-height: 1.5em;
}

.hidden {
  display: none !important;
}

d-article {
  padding-top: 2.5rem;
  padding-bottom: 30px;
}

d-appendix {
  padding-top: 30px;
}

d-article>p>img {
  width: 100%;
}

d-article h2 {
  margin: 1rem 0 1.5rem 0;
}

d-article h3 {
  margin-top: 1.5rem;
}

d-article iframe {
  border: 1px solid rgba(0, 0, 0, 0.1);
  margin-bottom: 2.0em;
  width: 100%;
}

/* Tweak code blocks */

d-article div.sourceCode code,
d-article pre code {
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
}

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: auto;
}

d-article div.sourceCode {
  background-color: white;
}

d-article div.sourceCode pre {
  padding-left: 10px;
  font-size: 12px;
  border-left: 2px solid rgba(0,0,0,0.1);
}

d-article pre {
  font-size: 12px;
  color: black;
  background: none;
  margin-top: 0;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

d-article pre a {
  border-bottom: none;
}

d-article pre a:hover {
  border-bottom: none;
  text-decoration: underline;
}

d-article details {
  grid-column: text;
  margin-bottom: 0.8em;
}

@media(min-width: 768px) {

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: visible !important;
}

d-article div.sourceCode pre {
  padding-left: 18px;
  font-size: 14px;
}

d-article pre {
  font-size: 14px;
}

}

figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

/* CSS for d-contents */

.d-contents {
  grid-column: text;
  color: rgba(0,0,0,0.8);
  font-size: 0.9em;
  padding-bottom: 1em;
  margin-bottom: 1em;
  padding-bottom: 0.5em;
  margin-bottom: 1em;
  padding-left: 0.25em;
  justify-self: start;
}

@media(min-width: 1000px) {
  .d-contents.d-contents-float {
    height: 0;
    grid-column-start: 1;
    grid-column-end: 4;
    justify-self: center;
    padding-right: 3em;
    padding-left: 2em;
  }
}

.d-contents nav h3 {
  font-size: 18px;
  margin-top: 0;
  margin-bottom: 1em;
}

.d-contents li {
  list-style-type: none
}

.d-contents nav > ul {
  padding-left: 0;
}

.d-contents ul {
  padding-left: 1em
}

.d-contents nav ul li {
  margin-top: 0.6em;
  margin-bottom: 0.2em;
}

.d-contents nav a {
  font-size: 13px;
  border-bottom: none;
  text-decoration: none
  color: rgba(0, 0, 0, 0.8);
}

.d-contents nav a:hover {
  text-decoration: underline solid rgba(0, 0, 0, 0.6)
}

.d-contents nav > ul > li > a {
  font-weight: 600;
}

.d-contents nav > ul > li > ul {
  font-weight: inherit;
}

.d-contents nav > ul > li > ul > li {
  margin-top: 0.2em;
}


.d-contents nav ul {
  margin-top: 0;
  margin-bottom: 0.25em;
}

.d-article-with-toc h2:nth-child(2) {
  margin-top: 0;
}


/* Figure */

.figure {
  position: relative;
  margin-bottom: 2.5em;
  margin-top: 1.5em;
}

.figure img {
  width: 100%;
}

.figure .caption {
  color: rgba(0, 0, 0, 0.6);
  font-size: 12px;
  line-height: 1.5em;
}

.figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

.figure .caption a {
  color: rgba(0, 0, 0, 0.6);
}

.figure .caption b,
.figure .caption strong, {
  font-weight: 600;
  color: rgba(0, 0, 0, 1.0);
}

/* Citations */

d-article .citation {
  color: inherit;
  cursor: inherit;
}

div.hanging-indent{
  margin-left: 1em; text-indent: -1em;
}

/* Citation hover box */

.tippy-box[data-theme~=light-border] {
  background-color: rgba(250, 250, 250, 0.95);
}

.tippy-content > p {
  margin-bottom: 0;
  padding: 2px;
}


/* Tweak 1000px media break to show more text */

@media(min-width: 1000px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 16px;
  }

  .grid {
    grid-column-gap: 16px;
  }

  d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
  }
  figure .caption, .figure .caption, figure figcaption {
    font-size: 13px;
  }
}

@media(min-width: 1180px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 32px;
  }

  .grid {
    grid-column-gap: 32px;
  }
}


/* Get the citation styles for the appendix (not auto-injected on render since
   we do our own rendering of the citation appendix) */

d-appendix .citation-appendix,
.d-appendix .citation-appendix {
  font-size: 11px;
  line-height: 15px;
  border-left: 1px solid rgba(0, 0, 0, 0.1);
  padding-left: 18px;
  border: 1px solid rgba(0,0,0,0.1);
  background: rgba(0, 0, 0, 0.02);
  padding: 10px 18px;
  border-radius: 3px;
  color: rgba(150, 150, 150, 1);
  overflow: hidden;
  margin-top: -12px;
  white-space: pre-wrap;
  word-wrap: break-word;
}

/* Include appendix styles here so they can be overridden */

d-appendix {
  contain: layout style;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-top: 60px;
  margin-bottom: 0;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  color: rgba(0,0,0,0.5);
  padding-top: 60px;
  padding-bottom: 48px;
}

d-appendix h3 {
  grid-column: page-start / text-start;
  font-size: 15px;
  font-weight: 500;
  margin-top: 1em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.65);
}

d-appendix h3 + * {
  margin-top: 1em;
}

d-appendix ol {
  padding: 0 0 0 15px;
}

@media (min-width: 768px) {
  d-appendix ol {
    padding: 0 0 0 30px;
    margin-left: -30px;
  }
}

d-appendix li {
  margin-bottom: 1em;
}

d-appendix a {
  color: rgba(0, 0, 0, 0.6);
}

d-appendix > * {
  grid-column: text;
}

d-appendix > d-footnote-list,
d-appendix > d-citation-list,
d-appendix > distill-appendix {
  grid-column: screen;
}

/* Include footnote styles here so they can be overridden */

d-footnote-list {
  contain: layout style;
}

d-footnote-list > * {
  grid-column: text;
}

d-footnote-list a.footnote-backlink {
  color: rgba(0,0,0,0.3);
  padding-left: 0.5em;
}



/* Anchor.js */

.anchorjs-link {
  /*transition: all .25s linear; */
  text-decoration: none;
  border-bottom: none;
}
*:hover > .anchorjs-link {
  margin-left: -1.125em !important;
  text-decoration: none;
  border-bottom: none;
}

/* Social footer */

.social_footer {
  margin-top: 30px;
  margin-bottom: 0;
  color: rgba(0,0,0,0.67);
}

.disqus-comments {
  margin-right: 30px;
}

.disqus-comment-count {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  cursor: pointer;
}

#disqus_thread {
  margin-top: 30px;
}

.article-sharing a {
  border-bottom: none;
  margin-right: 8px;
}

.article-sharing a:hover {
  border-bottom: none;
}

.sidebar-section.subscribe {
  font-size: 12px;
  line-height: 1.6em;
}

.subscribe p {
  margin-bottom: 0.5em;
}


.article-footer .subscribe {
  font-size: 15px;
  margin-top: 45px;
}


.sidebar-section.custom {
  font-size: 12px;
  line-height: 1.6em;
}

.custom p {
  margin-bottom: 0.5em;
}

/* Styles for listing layout (hide title) */
.layout-listing d-title, .layout-listing .d-title {
  display: none;
}

/* Styles for posts lists (not auto-injected) */


.posts-with-sidebar {
  padding-left: 45px;
  padding-right: 45px;
}

.posts-list .description h2,
.posts-list .description p {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

.posts-list .description h2 {
  font-weight: 700;
  border-bottom: none;
  padding-bottom: 0;
}

.posts-list h2.post-tag {
  border-bottom: 1px solid rgba(0, 0, 0, 0.2);
  padding-bottom: 12px;
}
.posts-list {
  margin-top: 60px;
  margin-bottom: 24px;
}

.posts-list .post-preview {
  text-decoration: none;
  overflow: hidden;
  display: block;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  padding: 24px 0;
}

.post-preview-last {
  border-bottom: none !important;
}

.posts-list .posts-list-caption {
  grid-column: screen;
  font-weight: 400;
}

.posts-list .post-preview h2 {
  margin: 0 0 6px 0;
  line-height: 1.2em;
  font-style: normal;
  font-size: 24px;
}

.posts-list .post-preview p {
  margin: 0 0 12px 0;
  line-height: 1.4em;
  font-size: 16px;
}

.posts-list .post-preview .thumbnail {
  box-sizing: border-box;
  margin-bottom: 24px;
  position: relative;
  max-width: 500px;
}
.posts-list .post-preview img {
  width: 100%;
  display: block;
}

.posts-list .metadata {
  font-size: 12px;
  line-height: 1.4em;
  margin-bottom: 18px;
}

.posts-list .metadata > * {
  display: inline-block;
}

.posts-list .metadata .publishedDate {
  margin-right: 2em;
}

.posts-list .metadata .dt-authors {
  display: block;
  margin-top: 0.3em;
  margin-right: 2em;
}

.posts-list .dt-tags {
  display: block;
  line-height: 1em;
}

.posts-list .dt-tags .dt-tag {
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0.3em 0.4em;
  margin-right: 0.2em;
  margin-bottom: 0.4em;
  font-size: 60%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

.posts-list img {
  opacity: 1;
}

.posts-list img[data-src] {
  opacity: 0;
}

.posts-more {
  clear: both;
}


.posts-sidebar {
  font-size: 16px;
}

.posts-sidebar h3 {
  font-size: 16px;
  margin-top: 0;
  margin-bottom: 0.5em;
  font-weight: 400;
  text-transform: uppercase;
}

.sidebar-section {
  margin-bottom: 30px;
}

.categories ul {
  list-style-type: none;
  margin: 0;
  padding: 0;
}

.categories li {
  color: rgba(0, 0, 0, 0.8);
  margin-bottom: 0;
}

.categories li>a {
  border-bottom: none;
}

.categories li>a:hover {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
}

.categories .active {
  font-weight: 600;
}

.categories .category-count {
  color: rgba(0, 0, 0, 0.4);
}


@media(min-width: 768px) {
  .posts-list .post-preview h2 {
    font-size: 26px;
  }
  .posts-list .post-preview .thumbnail {
    float: right;
    width: 30%;
    margin-bottom: 0;
  }
  .posts-list .post-preview .description {
    float: left;
    width: 45%;
  }
  .posts-list .post-preview .metadata {
    float: left;
    width: 20%;
    margin-top: 8px;
  }
  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.5em;
    font-size: 16px;
  }
  .posts-with-sidebar .posts-list {
    float: left;
    width: 75%;
  }
  .posts-with-sidebar .posts-sidebar {
    float: right;
    width: 20%;
    margin-top: 60px;
    padding-top: 24px;
    padding-bottom: 24px;
  }
}


/* Improve display for browsers without grid (IE/Edge <= 15) */

.downlevel {
  line-height: 1.6em;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  margin: 0;
}

.downlevel .d-title {
  padding-top: 6rem;
  padding-bottom: 1.5rem;
}

.downlevel .d-title h1 {
  font-size: 50px;
  font-weight: 700;
  line-height: 1.1em;
  margin: 0 0 0.5rem;
}

.downlevel .d-title p {
  font-weight: 300;
  font-size: 1.2rem;
  line-height: 1.55em;
  margin-top: 0;
}

.downlevel .d-byline {
  padding-top: 0.8em;
  padding-bottom: 0.8em;
  font-size: 0.8rem;
  line-height: 1.8em;
}

.downlevel .section-separator {
  border: none;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
}

.downlevel .d-article {
  font-size: 1.06rem;
  line-height: 1.7em;
  padding-top: 1rem;
  padding-bottom: 2rem;
}


.downlevel .d-appendix {
  padding-left: 0;
  padding-right: 0;
  max-width: none;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.5);
  padding-top: 40px;
  padding-bottom: 48px;
}

.downlevel .footnotes ol {
  padding-left: 13px;
}

.downlevel .base-grid,
.downlevel .distill-header,
.downlevel .d-title,
.downlevel .d-abstract,
.downlevel .d-article,
.downlevel .d-appendix,
.downlevel .distill-appendix,
.downlevel .d-byline,
.downlevel .d-footnote-list,
.downlevel .d-citation-list,
.downlevel .distill-footer,
.downlevel .appendix-bottom,
.downlevel .posts-container {
  padding-left: 40px;
  padding-right: 40px;
}

@media(min-width: 768px) {
  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
  padding-left: 150px;
  padding-right: 150px;
  max-width: 900px;
}
}

.downlevel pre code {
  display: block;
  border-left: 2px solid rgba(0, 0, 0, .1);
  padding: 0 0 0 20px;
  font-size: 14px;
}

.downlevel code, .downlevel pre {
  color: black;
  background: none;
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

.downlevel .posts-list .post-preview {
  color: inherit;
}



</style>

<script type="application/javascript">

function is_downlevel_browser() {
  if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                 window.navigator.userAgent)) {
    return true;
  } else {
    return window.load_distill_framework === undefined;
  }
}

// show body when load is complete
function on_load_complete() {

  // add anchors
  if (window.anchors) {
    window.anchors.options.placement = 'left';
    window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
  }


  // set body to visible
  document.body.style.visibility = 'visible';

  // force redraw for leaflet widgets
  if (window.HTMLWidgets) {
    var maps = window.HTMLWidgets.findAll(".leaflet");
    $.each(maps, function(i, el) {
      var map = this.getMap();
      map.invalidateSize();
      map.eachLayer(function(layer) {
        if (layer instanceof L.TileLayer)
          layer.redraw();
      });
    });
  }

  // trigger 'shown' so htmlwidgets resize
  $('d-article').trigger('shown');
}

function init_distill() {

  init_common();

  // create front matter
  var front_matter = $('<d-front-matter></d-front-matter>');
  $('#distill-front-matter').wrap(front_matter);

  // create d-title
  $('.d-title').changeElementType('d-title');

  // create d-byline
  var byline = $('<d-byline></d-byline>');
  $('.d-byline').replaceWith(byline);

  // create d-article
  var article = $('<d-article></d-article>');
  $('.d-article').wrap(article).children().unwrap();

  // move posts container into article
  $('.posts-container').appendTo($('d-article'));

  // create d-appendix
  $('.d-appendix').changeElementType('d-appendix');

  // flag indicating that we have appendix items
  var appendix = $('.appendix-bottom').children('h3').length > 0;

  // replace footnotes with <d-footnote>
  $('.footnote-ref').each(function(i, val) {
    appendix = true;
    var href = $(this).attr('href');
    var id = href.replace('#', '');
    var fn = $('#' + id);
    var fn_p = $('#' + id + '>p');
    fn_p.find('.footnote-back').remove();
    var text = fn_p.html();
    var dtfn = $('<d-footnote></d-footnote>');
    dtfn.html(text);
    $(this).replaceWith(dtfn);
  });
  // remove footnotes
  $('.footnotes').remove();

  // move refs into #references-listing
  $('#references-listing').replaceWith($('#refs'));

  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    var id = $(this).attr('id');
    $('.d-contents a[href="#' + id + '"]').parent().remove();
    appendix = true;
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
  });

  // show d-appendix if we have appendix content
  $("d-appendix").css('display', appendix ? 'grid' : 'none');

  // localize layout chunks to just output
  $('.layout-chunk').each(function(i, val) {

    // capture layout
    var layout = $(this).attr('data-layout');

    // apply layout to markdown level block elements
    var elements = $(this).children().not('details, div.sourceCode, pre, script');
    elements.each(function(i, el) {
      var layout_div = $('<div class="' + layout + '"></div>');
      if (layout_div.hasClass('shaded')) {
        var shaded_content = $('<div class="shaded-content"></div>');
        $(this).wrap(shaded_content);
        $(this).parent().wrap(layout_div);
      } else {
        $(this).wrap(layout_div);
      }
    });


    // unwrap the layout-chunk div
    $(this).children().unwrap();
  });

  // remove code block used to force  highlighting css
  $('.distill-force-highlighting-css').parent().remove();

  // remove empty line numbers inserted by pandoc when using a
  // custom syntax highlighting theme
  $('code.sourceCode a:empty').remove();

  // load distill framework
  load_distill_framework();

  // wait for window.distillRunlevel == 4 to do post processing
  function distill_post_process() {

    if (!window.distillRunlevel || window.distillRunlevel < 4)
      return;

    // hide author/affiliations entirely if we have no authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;
    if (!have_authors)
      $('d-byline').addClass('hidden');

    // article with toc class
    $('.d-contents').parent().addClass('d-article-with-toc');

    // strip links that point to #
    $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

    // add orcid ids
    $('.authors-affiliations').find('.author').each(function(i, el) {
      var orcid_id = front_matter.authors[i].orcidID;
      if (orcid_id) {
        var a = $('<a></a>');
        a.attr('href', 'https://orcid.org/' + orcid_id);
        var img = $('<img></img>');
        img.addClass('orcid-id');
        img.attr('alt', 'ORCID ID');
        img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
        a.append(img);
        $(this).append(a);
      }
    });

    // hide elements of author/affiliations grid that have no value
    function hide_byline_column(caption) {
      $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
    }

    // affiliations
    var have_affiliations = false;
    for (var i = 0; i<front_matter.authors.length; ++i) {
      var author = front_matter.authors[i];
      if (author.affiliation !== "&nbsp;") {
        have_affiliations = true;
        break;
      }
    }
    if (!have_affiliations)
      $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

    // published date
    if (!front_matter.publishedDate)
      hide_byline_column("Published");

    // document object identifier
    var doi = $('d-byline').find('h3:contains("DOI")');
    var doi_p = doi.next().empty();
    if (!front_matter.doi) {
      // if we have a citation and valid citationText then link to that
      if ($('#citation').length > 0 && front_matter.citationText) {
        doi.html('Citation');
        $('<a href="#citation"></a>')
          .text(front_matter.citationText)
          .appendTo(doi_p);
      } else {
        hide_byline_column("DOI");
      }
    } else {
      $('<a></a>')
         .attr('href', "https://doi.org/" + front_matter.doi)
         .html(front_matter.doi)
         .appendTo(doi_p);
    }

     // change plural form of authors/affiliations
    if (front_matter.authors.length === 1) {
      var grid = $('.authors-affiliations');
      grid.children('h3:contains("Authors")').text('Author');
      grid.children('h3:contains("Affiliations")').text('Affiliation');
    }

    // remove d-appendix and d-footnote-list local styles
    $('d-appendix > style:first-child').remove();
    $('d-footnote-list > style:first-child').remove();

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // hoverable references
    $('span.citation[data-cites]').each(function() {
      if ($(this).children()[0].nodeName == "D-FOOTNOTE") {
        var fn = $(this).children()[0]
        $(this).html(fn.shadowRoot.querySelector("sup"))
        $(this).id = fn.id
        fn.remove()
      }
      var refs = $(this).attr('data-cites').split(" ");
      var refHtml = refs.map(function(ref) {
        return "<p>" + $('#ref-' + ref).html() + "</p>";
      }).join("\n");
      window.tippy(this, {
        allowHTML: true,
        content: refHtml,
        maxWidth: 500,
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start'
      });
    });

    // clear polling timer
    clearInterval(tid);

    // show body now that everything is ready
    on_load_complete();
  }

  var tid = setInterval(distill_post_process, 50);
  distill_post_process();

}

function init_downlevel() {

  init_common();

   // insert hr after d-title
  $('.d-title').after($('<hr class="section-separator"/>'));

  // check if we have authors
  var front_matter = JSON.parse($("#distill-front-matter").html());
  var have_authors = front_matter.authors && front_matter.authors.length > 0;

  // manage byline/border
  if (!have_authors)
    $('.d-byline').remove();
  $('.d-byline').after($('<hr class="section-separator"/>'));
  $('.d-byline a').remove();

  // remove toc
  $('.d-contents').remove();

  // move appendix elements
  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
  });


  // inject headers into references and footnotes
  var refs_header = $('<h3></h3>');
  refs_header.text('References');
  $('#refs').prepend(refs_header);

  var footnotes_header = $('<h3></h3');
  footnotes_header.text('Footnotes');
  $('.footnotes').children('hr').first().replaceWith(footnotes_header);

  // move appendix-bottom entries to the bottom
  $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
  $('.appendix-bottom').remove();

  // remove appendix if it's empty
  if ($('.d-appendix').children().length === 0)
    $('.d-appendix').remove();

  // prepend separator above appendix
  $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

  // trim code
  $('pre>code').each(function(i, val) {
    $(this).html($.trim($(this).html()));
  });

  // move posts-container right before article
  $('.posts-container').insertBefore($('.d-article'));

  $('body').addClass('downlevel');

  on_load_complete();
}


function init_common() {

  // jquery plugin to change element types
  (function($) {
    $.fn.changeElementType = function(newType) {
      var attrs = {};

      $.each(this[0].attributes, function(idx, attr) {
        attrs[attr.nodeName] = attr.nodeValue;
      });

      this.replaceWith(function() {
        return $("<" + newType + "/>", attrs).append($(this).contents());
      });
    };
  })(jQuery);

  // prevent underline for linked images
  $('a > img').parent().css({'border-bottom' : 'none'});

  // mark non-body figures created by knitr chunks as 100% width
  $('.layout-chunk').each(function(i, val) {
    var figures = $(this).find('img, .html-widget');
    if ($(this).attr('data-layout') !== "l-body") {
      figures.css('width', '100%');
    } else {
      figures.css('max-width', '100%');
      figures.filter("[width]").each(function(i, val) {
        var fig = $(this);
        fig.css('width', fig.attr('width') + 'px');
      });

    }
  });

  // auto-append index.html to post-preview links in file: protocol
  // and in rstudio ide preview
  $('.post-preview').each(function(i, val) {
    if (window.location.protocol === "file:")
      $(this).attr('href', $(this).attr('href') + "index.html");
  });

  // get rid of index.html references in header
  if (window.location.protocol !== "file:") {
    $('.distill-site-header a[href]').each(function(i,val) {
      $(this).attr('href', $(this).attr('href').replace("index.html", "./"));
    });
  }

  // add class to pandoc style tables
  $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
  $('.kable-table').children('table').addClass('pandoc-table');

  // add figcaption style to table captions
  $('caption').parent('table').addClass("figcaption");

  // initialize posts list
  if (window.init_posts_list)
    window.init_posts_list();

  // implmement disqus comment link
  $('.disqus-comment-count').click(function() {
    window.headroom_prevent_pin = true;
    $('#disqus_thread').toggleClass('hidden');
    if (!$('#disqus_thread').hasClass('hidden')) {
      var offset = $(this).offset();
      $(window).resize();
      $('html, body').animate({
        scrollTop: offset.top - 35
      });
    }
  });
}

document.addEventListener('DOMContentLoaded', function() {
  if (is_downlevel_browser())
    init_downlevel();
  else
    window.addEventListener('WebComponentsReady', init_distill);
});

</script>

<style type="text/css">
/* base variables */

/* Edit the CSS properties in this file to create a custom
   Distill theme. Only edit values in the right column
   for each row; values shown are the CSS defaults.
   To return any property to the default,
   you may set its value to: unset
   All rows must end with a semi-colon.                      */

/* Optional: embed custom fonts here with `@import`          */
/* This must remain at the top of this file.                 */



html {
  /*-- Main font sizes --*/
  --title-size:      50px;
  --body-size:       1.06rem;
  --code-size:       14px;
  --aside-size:      12px;
  --fig-cap-size:    13px;
  /*-- Main font colors --*/
  --title-color:     #000000;
  --header-color:    rgba(0, 0, 0, 0.8);
  --body-color:      rgba(0, 0, 0, 0.8);
  --aside-color:     rgba(0, 0, 0, 0.6);
  --fig-cap-color:   rgba(0, 0, 0, 0.6);
  /*-- Specify custom fonts ~~~ must be imported above   --*/
  --heading-font:    sans-serif;
  --mono-font:       monospace;
  --body-font:       sans-serif;
  --navbar-font:     sans-serif;  /* websites + blogs only */
}

/*-- ARTICLE METADATA --*/
d-byline {
  --heading-size:    0.6rem;
  --heading-color:   rgba(0, 0, 0, 0.5);
  --body-size:       0.8rem;
  --body-color:      rgba(0, 0, 0, 0.8);
}

/*-- ARTICLE TABLE OF CONTENTS --*/
.d-contents {
  --heading-size:    18px;
  --contents-size:   13px;
}

/*-- ARTICLE APPENDIX --*/
d-appendix {
  --heading-size:    15px;
  --heading-color:   rgba(0, 0, 0, 0.65);
  --text-size:       0.8em;
  --text-color:      rgba(0, 0, 0, 0.5);
}

/*-- WEBSITE HEADER + FOOTER --*/
/* These properties only apply to Distill sites and blogs  */

.distill-site-header {
  --title-size:       18px;
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}

.distill-site-footer {
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}

/*-- Additional custom styles --*/
/* Add any additional CSS rules below                      */
</style>
<style type="text/css">
/* base variables */

/* Edit the CSS properties in this file to create a custom
   Distill theme. Only edit values in the right column
   for each row; values shown are the CSS defaults.
   To return any property to the default,
   you may set its value to: unset
   All rows must end with a semi-colon.                      */

/* Optional: embed custom fonts here with `@import`          */
/* This must remain at the top of this file.                 */



html {
  /*-- Main font sizes --*/
  --title-size:      50px;
  --body-size:       1.06rem;
  --code-size:       14px;
  --aside-size:      12px;
  --fig-cap-size:    13px;
  /*-- Main font colors --*/
  --title-color:     #000000;
  --header-color:    rgba(0, 0, 0, 0.8);
  --body-color:      rgba(0, 0, 0, 0.8);
  --aside-color:     rgba(0, 0, 0, 0.6);
  --fig-cap-color:   rgba(0, 0, 0, 0.6);
  /*-- Specify custom fonts ~~~ must be imported above   --*/
  --heading-font:    sans-serif;
  --mono-font:       monospace;
  --body-font:       sans-serif;
  --navbar-font:     sans-serif;  /* websites + blogs only */
}

/*-- ARTICLE METADATA --*/
d-byline {
  --heading-size:    0.6rem;
  --heading-color:   rgba(0, 0, 0, 0.5);
  --body-size:       0.8rem;
  --body-color:      rgba(0, 0, 0, 0.8);
}

/*-- ARTICLE TABLE OF CONTENTS --*/
.d-contents {
  --heading-size:    18px;
  --contents-size:   13px;
}

/*-- ARTICLE APPENDIX --*/
d-appendix {
  --heading-size:    15px;
  --heading-color:   rgba(0, 0, 0, 0.65);
  --text-size:       0.8em;
  --text-color:      rgba(0, 0, 0, 0.7);
}

/*-- WEBSITE HEADER + FOOTER --*/
/* These properties only apply to Distill sites and blogs  */

.distill-site-header {
  --title-size:       18px;
  --text-color:       rgba(0, 0, 0, 0.8);
  --text-size:        15px;
  --hover-color:      black;
  --bkgd-color:       #ffffff;
}

.distill-site-footer {
  --text-color:       rgba(0, 0, 0, 0.8);
  --text-size:        15px;
  --hover-color:      black;
  --bkgd-color:       #fafafa;
}

/*-- Additional custom styles --*/
/* Add any additional CSS rules below                      */

.nav-right > a {
  text-transform: uppercase;
}

d-title h1, d-title p, d-title figure,
d-abstract p, d-abstract b {
  grid-column: page;
}

.rj-blue {
  color: #2467bb;
}

ul li {
  line-height: 1.6;
  margin-top: 0em;
  margin-bottom: 0em;
}</style>
<style type="text/css">
/* base style */

/* FONT FAMILIES */

:root {
  --heading-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  --mono-default: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  --body-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

body,
.posts-list .post-preview p,
.posts-list .description p {
  font-family: var(--body-font), var(--body-default);
}

h1, h2, h3, h4, h5, h6,
.posts-list .post-preview h2,
.posts-list .description h2 {
  font-family: var(--heading-font), var(--heading-default);
}

d-article div.sourceCode code,
d-article pre code {
  font-family: var(--mono-font), var(--mono-default);
}


/*-- TITLE --*/
d-title h1,
.posts-list > h1 {
  color: var(--title-color, black);
}

d-title h1 {
  font-size: var(--title-size, 50px);
}

/*-- HEADERS --*/
d-article h1,
d-article h2,
d-article h3,
d-article h4,
d-article h5,
d-article h6 {
  color: var(--header-color, rgba(0, 0, 0, 0.8));
}

/*-- BODY --*/
d-article > p,  /* only text inside of <p> tags */
d-article > ul, /* lists */
d-article > ol {
  color: var(--body-color, rgba(0, 0, 0, 0.8));
  font-size: var(--body-size, 1.06rem);
}


/*-- CODE --*/
d-article div.sourceCode code,
d-article pre code {
  font-size: var(--code-size, 14px);
}

/*-- ASIDE --*/
d-article aside {
  font-size: var(--aside-size, 12px);
  color: var(--aside-color, rgba(0, 0, 0, 0.6));
}

/*-- FIGURE CAPTIONS --*/
figure .caption,
figure figcaption,
.figure .caption {
  font-size: var(--fig-cap-size, 13px);
  color: var(--fig-cap-color, rgba(0, 0, 0, 0.6));
}

/*-- METADATA --*/
d-byline h3 {
  font-size: var(--heading-size, 0.6rem);
  color: var(--heading-color, rgba(0, 0, 0, 0.5));
}

d-byline {
  font-size: var(--body-size, 0.8rem);
  color: var(--body-color, rgba(0, 0, 0, 0.8));
}

d-byline a,
d-article d-byline a {
  color: var(--body-color, rgba(0, 0, 0, 0.8));
}

/*-- TABLE OF CONTENTS --*/
.d-contents nav h3 {
  font-size: var(--heading-size, 18px);
}

.d-contents nav a {
  font-size: var(--contents-size, 13px);
}

/*-- APPENDIX --*/
d-appendix h3 {
  font-size: var(--heading-size, 15px);
  color: var(--heading-color, rgba(0, 0, 0, 0.65));
}

d-appendix {
  font-size: var(--text-size, 0.8em);
  color: var(--text-color, rgba(0, 0, 0, 0.5));
}

d-appendix d-footnote-list a.footnote-backlink {
  color: var(--text-color, rgba(0, 0, 0, 0.5));
}

/*-- WEBSITE HEADER + FOOTER --*/
.distill-site-header .title {
  font-size: var(--title-size, 18px);
  font-family: var(--navbar-font), var(--heading-default);
}

.distill-site-header a,
.nav-dropdown .nav-dropbtn {
  font-family: var(--navbar-font), var(--heading-default);
}

.nav-dropdown .nav-dropbtn {
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  font-size: var(--text-size, 15px);
}

.distill-site-header a:hover,
.nav-dropdown:hover .nav-dropbtn {
  color: var(--hover-color, white);
}

.distill-site-header {
  font-size: var(--text-size, 15px);
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  background-color: var(--bkgd-color, #0F2E3D);
}

.distill-site-footer {
  font-size: var(--text-size, 15px);
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  background-color: var(--bkgd-color, #0F2E3D);
}

.distill-site-footer a:hover {
  color: var(--hover-color, white);
}</style>
<!--/radix_placeholder_distill-->
  <script src="../../site_libs/header-attrs-2.12/header-attrs.js"></script>
  <script src="../../site_libs/kePrint-0.0.1/kePrint.js"></script>
  <link href="../../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
  <script src="../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
  <script src="../../site_libs/popper-2.6.0/popper.min.js"></script>
  <link href="../../site_libs/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="../../site_libs/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="../../site_libs/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="../../site_libs/anchor-4.2.2/anchor.min.js"></script>
  <script src="../../site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="../../site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="../../site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
<!--/radix_placeholder_site_in_header-->
  <script>
    $(function() {
      console.log("Starting...")

      // Always show Published - distill hides it if not set
      function show_byline_column(caption) {
        $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'visible');
      }

      show_byline_column('Published')

      // tweak function
      var rmd_meta = JSON.parse($("#radix-rmarkdown-metadata").html());
      function get_meta(name, meta) {
        var ind = meta.attributes.names.value.findIndex((e) => e == name)
        var val = meta.value[ind]
        if (val.type != 'list') {
          return val.value.toString()
        }
        return val
      }

      // tweak description
      // Add clickable tags
      const slug = get_meta('slug', rmd_meta)
      const doi = get_meta('doi', rmd_meta)

      var title = $("d-title").text

      const buttons = $('<div class="dt-tags" style="grid-column: page;">')
      buttons.append('<a href="#citation" class="dt-tag"><i class="fas fa-quote-left"></i> Cite</a>')
      buttons.append('<a href="' + slug + '.pdf" class="dt-tag"><i class="fas fa-file-pdf"></i> PDF</a>')
      buttons.append('<a href="https://twitter.com/intent/tweet?text='+title+'&url=https%3A%2F%2Fdoi.org%2F' + doi + '" class="dt-tag"><i class="fab fa-twitter"></i> Tweet</a>')

      const abstract = $('<d-abstract>')
      abstract.append('<b>Abstract:</b><br>')
      abstract.append($("d-title p:not(:empty)").first()) // Move description to d-abstract
      $("d-title p:empty").remove() // Remove empty paragraphs after title
      abstract.append(buttons)
      abstract.insertAfter($('d-title')) // Add abstract section after title

      // tweak by-line
      var byline = $("d-byline div.byline")
      ind = rmd_meta.attributes.names.value.findIndex((e) => e == "journal")
      const journal = get_meta('journal', rmd_meta)
      const volume = get_meta('volume', rmd_meta)
      const issue = get_meta('issue', rmd_meta)
      const jrtitle = get_meta('title', journal)
      const firstpage = get_meta('firstpage', journal)
      const lastpage = get_meta('lastpage', journal)
      byline.append('<div class="rjournal grid">')
      $('div.rjournal').append('<h3>Volume</h3>')
      $('div.rjournal').append('<h3>Pages</h3>')
      $('div.rjournal').append('<p class="volume">'+volume+':'+issue+'</p>')
      $('div.rjournal').append('<p class="pages">'+firstpage+' - '+lastpage+'</p>')

      const received_date = new Date(get_meta('date_received', rmd_meta))
      byline.find('h3:contains("Published")').parent().append('<h3>Received</h3><p>'+received_date.toLocaleDateString('en-US', {month: 'short'})+' '+received_date.getDate()+', '+received_date.getFullYear()+'</p>')

    })
  </script>

  <style>
      /*
    .nav-dropdown-content .nav-dropdown-header {
      text-transform: lowercase;
    }
    */

    d-byline .byline {
      grid-template-columns: 2fr 2fr 2fr 2fr;
    }

    d-byline .rjournal {
      grid-column-end: span 2;
      grid-template-columns: 1fr 1fr;
      margin-bottom: 0;
    }

    d-title h1, d-title p, d-title figure,
    d-abstract p, d-abstract b {
      grid-column: page;
    }

    d-title .dt-tags {
      grid-column: page;
    }

    .dt-tags .dt-tag {
      text-transform: lowercase;
    }

    d-article h1 {
      line-height: 1.1em;
    }

    d-abstract p, d-article p {
      text-align: justify;
    }

    @media(min-width: 1000px) {
      .d-contents.d-contents-float {
        justify-self: end;
      }

      nav.toc {
        border-right: 1px solid rgba(0, 0, 0, 0.1);
        border-right-width: 1px;
        border-right-style: solid;
        border-right-color: rgba(0, 0, 0, 0.1);
      }
    }

    .posts-list .dt-tags .dt-tag {
      text-transform: lowercase;
    }

    @keyframes highlight-target {
      0% {
        background-color: #ffa;
      }
      66% {
        background-color: #ffa;
      }
      100% {
        background-color: none;
      }
    }

    d-article :target, d-appendix :target {
       animation: highlight-target 3s;
    }
  </style>


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Finding Optimal Normalizing Transformations via bestNormalize","description":"The bestNormalize R package was designed to help users find a transformation that can effectively normalize a vector regardless of its actual distribution. Each of the many normalization techniques that have been developed has its own strengths and weaknesses, and deciding which to use until data are fully observed is difficult or impossible. This package facilitates choosing between a range of possible transformations and will automatically return  the best one, i.e., the one that makes data look the *most* normal. To evaluate and compare  the normalization efficacy across a suite of possible transformations, we developed a  statistic based on a goodness of fit test divided by its degrees of freedom.  Transformations can be seamlessly trained and applied to newly observed data  and can be implemented in conjunction with caret and recipes for  data preprocessing in machine learning workflows. Custom transformations and  normalization statistics are supported.","doi":"10.32614/RJ-2021-041","authors":[{"author":"Ryan A. Peterson","authorURL":"https://petersonr.github.io/","affiliation":"Department of Biostatistics and Informatics\n","affiliationURL":"#","orcidID":""}],"publishedDate":"2021-06-07T00:00:00.000+10:00","citationText":"Peterson, 2021"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="distill-site-nav distill-site-header">
<div class="nav-left">
<a class="logo" href="../../index.html">
<img src="../../resources/rlogo.png" alt="Logo"/>
</a>
<a href="../../index.html" class="title">The R Journal</a>
</div>
<div class="nav-right">
<a href="../../index.html">Home</a>
<a href="../../articles.html">Articles</a>
<a href="../../issues.html">Issues</a>
<a href="../../submissions.html">Submit</a>
<a href="../../articles.xml">
<i class="fa fa-rss" aria-hidden="true"></i>
</a>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Finding Optimal Normalizing Transformations via bestNormalize</h1>
<!--radix_placeholder_categories-->
<!--/radix_placeholder_categories-->
<p><p>The bestNormalize R package was designed to help users find a
transformation that can effectively normalize a vector regardless of its
actual distribution. Each of the many normalization techniques that have
been developed has its own strengths and weaknesses, and deciding which
to use until data are fully observed is difficult or impossible. This
package facilitates choosing between a range of possible transformations
and will automatically return the best one, i.e., the one that makes
data look the <em>most</em> normal. To evaluate and compare the
normalization efficacy across a suite of possible transformations, we
developed a statistic based on a goodness of fit test divided by its
degrees of freedom. Transformations can be seamlessly trained and
applied to newly observed data and can be implemented in conjunction
with caret and recipes for data preprocessing in machine learning
workflows. Custom transformations and normalization statistics are
supported.</p></p>
</div>

<div class="d-byline">
  Ryan A. Peterson <a href="https://petersonr.github.io/"
class="uri">https://petersonr.github.io/</a> (<p>Department of
Biostatistics and Informatics</p>)
  
<br/>2021-06-07
</div>

<div class="d-article">
<h1 id="introduction">Introduction</h1>
<p>The <a
href="https://cran.r-project.org/package=bestNormalize">bestNormalize</a>
package contains a suite of transformation-estimating functions that can
be used to normalize data. The function of the same name attempts to
find and execute the best of all of these potential normalizing
transformations. In this package, we define “normalize” as in “to render
data Gaussian”, rather than transform them to a specific scale.</p>
<p>There are many instances where researchers may want to normalize a
variable. First, there is the (often problematic) assumption of
normality of the outcome (conditional on the covariates) in the
classical linear regression problem. Over the years, many methods have
been used to relax this assumption: generalized linear models, quantile
regression, survival models, etc. One technique that is still somewhat
popular in this context is to “beat the data” to look normal via some
kind of normalizing transformation. This could be something as simple as
a log transformation or something as complex as a Yeo-Johnson
transformation <span class="citation" data-cites="yeojohnson">(<a
href="#ref-yeojohnson"
role="doc-biblioref"><strong>yeojohnson?</strong></a>)</span>. In fact,
many complex normalization methods were designed expressly to find a
transformation that could render regression residuals Gaussian. While
perhaps not the most elegant solution to the problem, often, this
technique works well as a quick solution. Another increasingly popular
application of normalization occurs in applied regression settings with
highly skewed distributions of the covariates <span class="citation"
data-cites="kuhn2013APM">(<a href="#ref-kuhn2013APM"
role="doc-biblioref">Kuhn and Johnson 2013</a>)</span>. In these
settings, there exists the tendency to have high leverage points (and
highly influential points), even when one centers and scales the
covariates. When examining interactions, these influential points can
become especially problematic since the leverage of that point gets
amplified for every interaction in which it is involved. Normalization
of such covariates can mitigate their leverage and influence, thereby
allowing for easier model selection and more robust downstream predictor
manipulations (such as principal components analysis), which can
otherwise be sensitive to skew or outliers. As a result, popular model
selection packages such as <a
href="https://cran.r-project.org/package=caret">caret</a> <span
class="citation" data-cites="caret">(<a href="#ref-caret"
role="doc-biblioref">Kuhn 2017</a>)</span> and <a
href="https://cran.r-project.org/package=recipes">recipes</a> <span
class="citation" data-cites="recipes">(<a href="#ref-recipes"
role="doc-biblioref">Kuhn and Wickham 2018</a>)</span> have built-in
mechanisms to normalize the predictor variables (they call this
“preprocessing”). This concept is unique in that it forgoes the
assumption of linearity between the outcome (Y) and the covariate,
opting instead for a linear relationship between Y and the transformed
value of the covariate (which in many cases may be more plausible).</p>
<p>This package is designed to make normalization effortless and
consistent. We have also introduced Ordered Quantile (ORQ) normalization
via the function, which uses a rank mapping of the observed data to the
normal distribution in order to guarantee normally distributed
transformed data (if ties are not present). We have shown how ORQ
normalization performs very consistently across different distributions,
successfully normalizing left- or right-skewed data, multi-modal data,
and even data generated from a Cauchy distribution <span
class="citation" data-cites="orq_paper">(<a href="#ref-orq_paper"
role="doc-biblioref">Peterson and Cavanaugh 2019</a>)</span>.</p>
<p>In this paper, we describe our R package <a
href="#">bestNormalize</a>, which is available via the Comprehensive R
Archive Network (CRAN). First, we describe normalization methods that
have been developed and that we implement in the package. Second, we
describe the novel cross-validation-based estimation procedure, which we
utilize to judge the normalization efficacy of our suite of
normalization transformations. Third, we go through some basic examples
of <a href="#">bestNormalize</a> functionality and a simple
implementation of our methods within the <a href="#">recipes</a>
package. We illustrate a more in-depth use-case in a car pricing
application, performing a transform-both-sides regression as well as
comparing the performance of several predictive models fit via <a
href="#">caret</a>. Finally, we conclude by discussing the pros and cons
of normalization in general and future directions for the package.</p>
<h1 id="normalization-methods">Normalization methods</h1>
<p>Many normalization transformation functions exist, and though some
can be implemented well in existing R packages, <a
href="#">bestNormalize</a> puts them all under the same umbrella syntax.
This section describes each transformation contained in the <a
href="#">bestNormalize</a> suite.</p>
<h2 id="the-box-cox-transformation">The Box-Cox transformation</h2>
<p>The Box-Cox transformation was famously proposed in <span
class="citation" data-cites="BoxCox1964">Box and Cox (<a
href="#ref-BoxCox1964" role="doc-biblioref">1964</a>)</span> and can be
implemented with differing syntax and methods in many existing packages
in R (e.g., <a href="#">caret</a>, <a
href="https://cran.r-project.org/package=MASS">MASS</a> <span
class="citation" data-cites="MASS">(<a href="#ref-MASS"
role="doc-biblioref">Venables and Ripley 2002</a>)</span>, and more). It
is a straightforward transformation that typically only involves one
parameter, <span class="math inline">\(\lambda\)</span>:</p>
<p><span class="math display">\[
g(x; \lambda) = \boldsymbol 1 _{(\lambda \neq 0)}
\frac{x^\lambda-1}{\lambda}
+ \boldsymbol 1_{(\lambda = 0)} \log x\text{ ,}
\]</span></p>
<p>where <span class="math inline">\(x\)</span> refers to the datum in
its original unit (pre-transformation). Given multiple observations, the
<span class="math inline">\(\lambda\)</span> parameter can be estimated
via maximum likelihood, and <span class="math inline">\(x\)</span> must
be greater than zero.</p>
<h2 id="the-yeo-johnson-transformation">The Yeo-Johnson
transformation</h2>
<p>The Yeo-Johnson transformation <span class="citation"
data-cites="yeojohnson">(<a href="#ref-yeojohnson"
role="doc-biblioref"><strong>yeojohnson?</strong></a>)</span> attempts
to find the value of <span class="math inline">\(\lambda\)</span> in the
following equation that minimizes the Kullback-Leibler distance between
the normal distribution and the transformed distribution.</p>
<p><span class="math display">\[
\begin{aligned}
g(x;\lambda) &amp;=
\boldsymbol 1 _{(\lambda \neq 0, x \geq 0)}
\frac{(x+1)^\lambda-1}{\lambda} \\
&amp;+ \boldsymbol 1_{(\lambda = 0, x \geq 0)} \log (x+1) \\
&amp;+ \boldsymbol 1_{(\lambda \neq 2, x &lt; 0)}
\frac{(1-x)^{2-\lambda}-1}{\lambda - 2} \\
&amp;+ \boldsymbol 1_{(\lambda = 2, x &lt; 0)} -\log (1-x) \\
\end{aligned}
\]</span></p>
<p>This method has the advantage of working without having to worry
about the domain of <span class="math inline">\(x\)</span>. As with the
Box-Cox <span class="math inline">\(\lambda\)</span>, this <span
class="math inline">\(\lambda\)</span> parameter can be estimated via
maximum likelihood.</p>
<h2 id="the-lambert-w-x-f-transformation">The Lambert W x F
transformation</h2>
<p>The Lambert W x F transformation, proposed in <span class="citation"
data-cites="goerg2011">Goerg (<a href="#ref-goerg2011"
role="doc-biblioref">2011</a>)</span> and implemented in the <a
href="https://cran.r-project.org/package=LambertW">LambertW</a> package,
is essentially a mechanism that de-skews a random variable <span
class="math inline">\(X\)</span> using moments. The method is motivated
by a system theory and is alleged to be able to transform any random
variable into any other kind of random variable, thus being applicable
to a large number of contexts. One of the package’s main functions is ,
which is similar in spirit to the purpose of this package. However, this
method may not perform as well on certain shapes of distributions as
other candidate transformations; see <span class="citation"
data-cites="orq_paper">Peterson and Cavanaugh (<a href="#ref-orq_paper"
role="doc-biblioref">2019</a>)</span> for some examples.</p>
<p>The transformation can handle three types of transformations: skewed,
heavy-tailed, and skewed heavy-tailed. For more details on this
transformation, consult the <a href="#">LambertW</a> documentation.<a
href="#">bestNormalize</a> While the transformations contained and
implemented by are reversible (i.e., 1-1), in rare circumstances, we
have observed that the function can yield non-reversible
transformations.</p>
<h2 id="the-ordered-quantile-technique">The Ordered Quantile
technique</h2>
<p>The ORQ normalization technique () is based on the following
transformation (originally discussed, as far as we can find, in <span
class="citation" data-cites="bartlett1947">Bartlett (<a
href="#ref-bartlett1947" role="doc-biblioref">1947</a>)</span> and
further developed in <span class="citation" data-cites="van1952">Van der
Waerden (<a href="#ref-van1952"
role="doc-biblioref">1952</a>)</span>):</p>
<p>Let <span class="math inline">\(\underline x\)</span> refer to the
original data. Then the transformation is:</p>
<p><span class="math display">\[
g(\underline x) = \Phi ^{-1} \left(\frac{\text{rank} (\underline x) -
1/2}{\text{length}(\underline x) }\right)
\]</span></p>
<p>This nonparametric transformation as defined works well on the
observed data, but it is not trivial to implement in modern settings
where the transformation needs to be applied on new data; we discussed
this issue and our solution to it in <span class="citation"
data-cites="orq_paper">Peterson and Cavanaugh (<a href="#ref-orq_paper"
role="doc-biblioref">2019</a>)</span>. Basically, on new data
<em>within</em> the range of the original data, ORQ normalization will
linearly interpolate between two of the original data points. On new
data <em>outside</em> the range of the original data, the transformation
extrapolates using a shifted logit approximation of the ranks to the
original data. This is visualized below via the data set on the
variable.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:orqvis"></span>
<img src="figs/orqvis-1.png" alt="ORQ normalization visualization on Fisher's iris data." width="100%" />
<p class="caption">
Figure 1: ORQ normalization visualization on Fisher’s iris data.
</p>
</div>
</div>
<p>The shifted logit extrapolation ensures that the function is 1-1 and
can handle data outside the original (observed) domain. The effects of
the approximation will usually be relatively minimal since we should not
expect to see many observations outside the observed range if the
training set sample size is large relative to the test set. The ORQ
technique will not guarantee a normal distribution in the presence of
ties, but it still could yield the best normalizing transformation when
compared to the other possible approaches. More information on ORQ
normalization can be found in <span class="citation"
data-cites="orq_paper">Peterson and Cavanaugh (<a href="#ref-orq_paper"
role="doc-biblioref">2019</a>)</span> or in the <a
href="#">bestNormalize</a> documentation.</p>
<h2 id="other-included-transformations">Other included
transformations</h2>
<p>In addition to the techniques above, the <a
href="#">bestNormalize</a> package performs and evaluates:</p>
<ul>
<li><span class="math inline">\(\log_b(x + a)\)</span> where <span
class="math inline">\(a = \max(0, -\min(x) + \epsilon)\)</span> and
<span class="math inline">\(b = 10\)</span> by default</li>
<li><span class="math inline">\(\sqrt{x + a}\)</span> where <span
class="math inline">\(a = \max(0, -\min(x))\)</span> by default</li>
<li><span class="math inline">\(\exp(x)\)</span></li>
<li><span class="math inline">\(\text {arcsinh}(x) = log(x + \sqrt{x^2 +
1})\)</span></li>
</ul>
<h2 id="other-not-included-transformations">Other not-included
transformations</h2>
<p>A range of other normalization techniques has been proposed that are
not included in this package (at the time of writing). These include
(but are not limited to): Modified Box-Cox <span class="citation"
data-cites="BoxCox1964">(<a href="#ref-BoxCox1964"
role="doc-biblioref">Box and Cox 1964</a>)</span>, Manly’s Exponential
<span class="citation" data-cites="Manly">(<a href="#ref-Manly"
role="doc-biblioref">Manly 1976</a>)</span>, John/Draper’s Modulus <span
class="citation" data-cites="JohnDraper">(<a href="#ref-JohnDraper"
role="doc-biblioref">John and Draper 1980</a>)</span>, and
Bickel/Doksum’s Modified Box-Cox <span class="citation"
data-cites="BickelDoksum">(<a href="#ref-BickelDoksum"
role="doc-biblioref">Bickel and Doksum 1981</a>)</span>. However, it is
straightforward to add new transformations into the same framework as
other included transformations; each one is treated as its own S3 class,
so in order to add other transformations, all one must do is define a
new S3 class and provide the requisite S3 methods. To this end, we
encourage readers to submit a pull request to <a
href="https://github.com/petersonR/bestNormalize">the package’s GitHub
page</a> with new transformation techniques that could be then added as
a default in . Otherwise, in a later section, we show how users can
implement custom transformations alongside the default ones described
above.</p>
<h1 id="which-transformation-best-normalizes-the-data">Which
transformation “best normalizes” the data?</h1>
<p>The function selects the best transformation according to an
extra-sample estimate of the Pearson P statistic divided by its degrees
of freedom (<span class="math inline">\(DF\)</span>). This P statistic
is defined as</p>
<p><span class="math display">\[
P = \sum_{i=1}^{k} \frac{(O_i - E_i)^2}{E_i}\text{ ,}
\]</span></p>
<p>where <span class="math inline">\(O_i\)</span> is the number
observed, and <span class="math inline">\(E_i\)</span> is the number of
expected (under the hypothesis of normality) to fall into “bin” <span
class="math inline">\(i\)</span>. The bins (or “classes”) are built such
that observations will fall into each one with equal probability under
the hypothesis of normality. A variety of alternative normality tests
exist, but this particular one is relatively interpretable as a goodness
of fit test, and the ratio <span class="math inline">\(P/DF\)</span> can
be compared between transformations as an absolute measure of departure
from normality. Specifically, if the data in question follow a normal
distribution, this ratio will be close to 1 or lower. The transformation
which produces data with the lowest normality statistic is thus the most
effective at normalizing the data, and gets selected by . The <a
href="#">bestNormalize</a> package utilizes <a
href="https://cran.r-project.org/package=nortest">nortest</a> <span
class="citation" data-cites="nortest">(<a href="#ref-nortest"
role="doc-biblioref">Gross and Ligges 2015</a>)</span> to compute this
statistic; more information on its computation and degrees of freedom
can be found in <span class="citation"
data-cites="d1986goodness">D’Agostino (<a href="#ref-d1986goodness"
role="doc-biblioref">1986</a>)</span> and <span class="citation"
data-cites="thode2002testing">Thode (<a href="#ref-thode2002testing"
role="doc-biblioref">2002</a>)</span>.</p>
<p>Normality statistics for all candidate transformations can be
estimated and compared with one simple call to , whose output makes it
easy to see which transformations are viable and which are not. We have
found that while complicated transformations are often <em>most</em>
effective and therefore selected automatically, sometimes a simple
transformation (e.g., the log or identity transforms) may be almost as
effective, and ultimately the latter type will yield more interpretable
results.</p>
<p>It is worth noting that when the normality statistic is estimated on
in-sample data, the ORQ technique is predestined to be most effective
since it is forcing its transformed data to follow a normal distribution
exactly <span class="citation" data-cites="orq_paper">(<a
href="#ref-orq_paper" role="doc-biblioref">Peterson and Cavanaugh
2019</a>)</span>. For this reason, by default, the function calculates
an <em>out-of-sample</em> estimate for the <span
class="math inline">\(P/DF\)</span> statistic. Since this method
necessitates cross-validation, it can be computationally frustrating for
three reasons: (1) the results and the chosen transformation can depend
on the seed, (2) it takes considerably longer to estimate than the
in-sample statistic, and (3) it is unclear how to choose the number of
folds and repeats.</p>
<p>In order to mediate these issues, we have built several features into
<a href="#">bestNormalize</a>. Issue (1) is only important for small
sample sizes, and when it is a concern, the best transformations should
look similar to one another. We address two solutions to (2) in the next
section. In short, we have methods to parallelize or simplify the
estimation of the statistic. For (3), we recommend 10-fold
cross-validation with 5 repeats as the default, but if the sample is
small, we suggest using 5 (or fewer) folds instead with more repeats;
accurate estimation of <span class="math inline">\(P/DF\)</span>
requires a relatively large fold size (as a rule of thumb, 20
observations per fold seems to be enough for most cases, but this
unfortunately depends on the distribution of the observed data).</p>
<h1 id="simple-examples">Simple examples</h1>
<p>In this section, we illustrate a simple use-case of the functions
provided in <a href="#">bestNormalize</a>.</p>
<h2 id="basic-implementation">Basic implementation</h2>
First, we will generate and plot some skewed data:
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/GammaDist.html'>rgamma</a></span><span class='op'>(</span><span class='fl'>250</span>, <span class='fl'>1</span>, <span class='fl'>1</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:simplehist"></span>
<img src="figs/simplehist-1.png" alt="Simulated skewed data for simple example." width="2.5in" height="1.3in" />
<p class="caption">
Figure 2: Simulated skewed data for simple example.
</p>
</div>
</div>
<p>To perform a suite of potential transformations and see how
effectively they normalized this vector, simply call :</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='op'>(</span><span class='va'>BNobject</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://petersonr.github.io/bestNormalize/reference/bestNormalize.html'>bestNormalize</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>Best Normalizing transformation with 250 Observations
 Estimated Normality Statistics (Pearson P / df, lower =&gt; more normal):
 - arcsinh(x): 1.7917
 - Box-Cox: 1.0442
 - Center+scale: 3.0102
 - Exp(x): 9.5306
 - Log_b(x+a): 1.7072
 - orderNorm (ORQ): 1.1773
 - sqrt(x + a): 1.144
 - Yeo-Johnson: 1.1875
Estimation method: Out-of-sample via CV with 10 folds and 5 repeats
 
Based off these, bestNormalize chose:
Standardized Box Cox Transformation with 250 nonmissing obs.:
 Estimated statistics:
 - lambda = 0.3254863 
 - mean (before standardization) = -0.3659267 
 - sd (before standardization) = 0.9807881 </code></pre>
</div>
<p>Evidently, the Box-Cox transformation performed the best, though many
other transformations performed similarly. We can visualize the suite of
transformations using the built-in method:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>BNobject</span>, leg_loc <span class='op'>=</span> <span class='st'>"topleft"</span><span class='op'>)</span>
</code></pre>
</div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:bnplot"></span>
<a href="#">bestNormalize</a>
<p class="caption">
Figure 3: The suite of transformations estimated by default in <a
href="#">bestNormalize</a> (trained on simulated right-skewed data).
</p>
</div>
</div>
<p>Finally, we can execute the best performing normalization on new data
with or reverse the transformation with . Note that normalized values
can either be obtained using or by extracting from the object. The best
transformation, in this case, is plotted in Figure 4.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:histbest"></span>
<img src="figs/histbest-1.png" alt="Summary of transformations performed on simulated right-skewed data." width="100%" />
<p class="caption">
Figure 4: Summary of transformations performed on simulated
right-skewed data.
</p>
</div>
</div>
<h2 id="performing-transformations-individually">Performing
transformations individually</h2>
Each method can be performed (and stored) individually:
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='op'>(</span><span class='va'>arcsinh_obj</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://petersonr.github.io/bestNormalize/reference/arcsinh_x.html'>arcsinh_x</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>Standardized asinh(x) Transformation with 250 nonmissing obs.:
 Relevant statistics:
 - mean (before standardization) = 0.7383146 
 - sd (before standardization) = 0.5458515 </code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='op'>(</span><span class='va'>boxcox_obj</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://petersonr.github.io/bestNormalize/reference/boxcox.html'>boxcox</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>Standardized Box Cox Transformation with 250 nonmissing obs.:
 Estimated statistics:
 - lambda = 0.3254863 
 - mean (before standardization) = -0.3659267 
 - sd (before standardization) = 0.9807881 </code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='op'>(</span><span class='va'>yeojohnson_obj</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://petersonr.github.io/bestNormalize/reference/yeojohnson.html'>yeojohnson</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>Standardized Yeo-Johnson Transformation with 250 nonmissing obs.:
 Estimated statistics:
 - lambda = -0.7080476 
 - mean (before standardization) = 0.4405464 
 - sd (before standardization) = 0.2592004 </code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='op'>(</span><span class='va'>lambert_obj</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://petersonr.github.io/bestNormalize/reference/lambert.html'>lambert</a></span><span class='op'>(</span><span class='va'>x</span>, type <span class='op'>=</span> <span class='st'>"s"</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>Standardized Lambert WxF Transformation of type s with 250 nonmissing obs.:
 Estimated statistics:
 - gamma = 0.3729
 - mean (before standardization) = 0.6781864 
 - sd (before standardization) = 0.7123011 </code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='op'>(</span><span class='va'>orderNorm_obj</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://petersonr.github.io/bestNormalize/reference/orderNorm.html'>orderNorm</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>orderNorm Transformation with 250 nonmissing obs and no ties 
 - Original quantiles:
   0%   25%   50%   75%  100% 
0.001 0.268 0.721 1.299 4.161 </code></pre>
</div>
<p>All normalization techniques in have their own class with convenient
S3 methods and documentation. For instance, we can use the method to
perform the transformation on new values using the objects we have just
created, visualizing them in a plot:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>xx</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>min</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>, length <span class='op'>=</span> <span class='fl'>100</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>xx</span>, <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>arcsinh_obj</span>, newdata <span class='op'>=</span> <span class='va'>xx</span><span class='op'>)</span>, type <span class='op'>=</span> <span class='st'>"l"</span>, col <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/lines.html'>lines</a></span><span class='op'>(</span><span class='va'>xx</span>, <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>boxcox_obj</span>, newdata <span class='op'>=</span> <span class='va'>xx</span><span class='op'>)</span>, col <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/lines.html'>lines</a></span><span class='op'>(</span><span class='va'>xx</span>, <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>yeojohnson_obj</span>, newdata <span class='op'>=</span> <span class='va'>xx</span><span class='op'>)</span>, col <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/lines.html'>lines</a></span><span class='op'>(</span><span class='va'>xx</span>, <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>orderNorm_obj</span>, newdata <span class='op'>=</span> <span class='va'>xx</span><span class='op'>)</span>, col <span class='op'>=</span> <span class='fl'>4</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:visdata2"></span>
<img src="figs/visdata2-1.png" alt="Manually plotting transformations trained on simulated right-skewed data." width="4.375in" height="2.5in" />
<p class="caption">
Figure 5: Manually plotting transformations trained on simulated
right-skewed data.
</p>
</div>
</div>
<h2 id="in-sample-normalization-efficacy">In-sample normalization
efficacy</h2>
<p>To examine how each of the normalization methods performed
(in-sample), we can visualize the transformed values in histograms
(Figure 6), which plot the transformed data, , stored in the
transformation objects we created previously.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:histtrans"></span>
<img src="figs/histtrans-1.png" alt="Normalized values for trained transformations on simulated right-skewed data." width="4in" height="4in" />
<p class="caption">
Figure 6: Normalized values for trained transformations on
simulated right-skewed data.
</p>
</div>
</div>
<p>Evidently, ORQ normalization appears to have worked perfectly to
normalize the data (as expected), and the Box-Cox method seemed to do
quite well too.</p>
<h2 id="out-of-sample-normalization-efficacy">Out-of-sample
normalization efficacy</h2>
<p>The function performs repeated (r=5) 10-fold cross-validation (CV) by
default and stores the estimated normality statistic for each left-out
fold/repeat into . Users can access and visualize these results via a
boxplot (see below), which may give some insight into whether the
transformation is truly preferred by the normality statistic or if
another (possibly simpler) transformation can be applied that would
achieve the approximately the same results. In this example, Box-Cox,
square-root, Yeo-Johnson, and ORQ seem to do similarly well, whereas the
identity transform, hyperbolic arc-sine, logging, and exponentiation are
performing worse.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/boxplot.html'>boxplot</a></span><span class='op'>(</span><span class='va'>BNobject</span><span class='op'>$</span><span class='va'>oos_preds</span>, log <span class='op'>=</span> <span class='st'>'y'</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/abline.html'>abline</a></span><span class='op'>(</span>h <span class='op'>=</span> <span class='fl'>1</span>, col <span class='op'>=</span> <span class='st'>"green3"</span><span class='op'>)</span>
</code></pre>
</div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:boxplot"></span>
<img src="figs/boxplot-1.png" alt="Cross-validation results for each normalization method, where our estimated normality statistic is plotted on the y-axis." width="100%" />
<p class="caption">
Figure 7: Cross-validation results for each normalization method,
where our estimated normality statistic is plotted on the y-axis.
</p>
</div>
</div>
<p>Leave-one-out CV can be optionally performed in via the argument,
which, if set to , will compute the leave-one-out CV transformations for
each observation and method. Specifically, will be run <span
class="math inline">\(n\)</span> separate times where each observation
is individually left out of the fitting process and subsequently plugged
back in to get a “leave-one-out transformed value”. Instead of taking
the mean across repeats and folds, in this case, we estimate
normalization efficacy using the full distribution of leave-one-out
transformed values. This option is computationally intensive. Note that
as with the “in-sample” normality statistics, the leave-one-out CV
approach tends to select the ORQ transformation since ORQ’s performance
improves as the number of points in the training set relative to the
testing set increases.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://petersonr.github.io/bestNormalize/reference/bestNormalize.html'>bestNormalize</a></span><span class='op'>(</span><span class='va'>x</span>, loo <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>Best Normalizing transformation with 250 Observations
 Estimated Normality Statistics (Pearson P / df, lower =&gt; more normal):
 - arcsinh(x): 4.42
 - Box-Cox: 0.7055
 - Center+scale: 8.258
 - Exp(x): 62.085
 - Log_b(x+a): 3.546
 - orderNorm (ORQ): 0.012
 - sqrt(x + a): 0.9145
 - Yeo-Johnson: 1.608
Estimation method: Out-of-sample via leave-one-out CV
 
Based off these, bestNormalize chose:
orderNorm Transformation with 250 nonmissing obs and no ties 
 - Original quantiles:
   0%   25%   50%   75%  100% 
0.001 0.268 0.721 1.299 4.161 </code></pre>
</div>
<h1 id="important-features">Important features</h1>
<h2 id="improving-speed-of-estimation">Improving speed of
estimation</h2>
<p>Because uses repeated CV by default to estimate the out-of-sample
normalization efficacy, it can be quite slow for larger objects. There
are several means of speeding up the process. Each comes with some pros
and cons. The first option is to specify . This will highly speed up the
process. However, for reasons previously discussed, ORQ normalization
will always be chosen unless . Therefore, a user might as well use the
function directly as opposed to only setting since the end result will
be the same (and will run much faster). Note below that the in-sample
normality results may differ slightly from the leave-one-out even when
this may be unexpected (i.e., for the log transformation); this is due
to slight differences in the standardization statistics.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://petersonr.github.io/bestNormalize/reference/bestNormalize.html'>bestNormalize</a></span><span class='op'>(</span><span class='va'>x</span>, allow_orderNorm <span class='op'>=</span> <span class='cn'>FALSE</span>, out_of_sample <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>Best Normalizing transformation with 250 Observations
 Estimated Normality Statistics (Pearson P / df, lower =&gt; more normal):
 - arcsinh(x): 4.401
 - Box-Cox: 0.7435
 - Center+scale: 8.087
 - Exp(x): 64.6975
 - Log_b(x+a): 3.47
 - sqrt(x + a): 0.9145
 - Yeo-Johnson: 1.7125
Estimation method: In-sample
 
Based off these, bestNormalize chose:
Standardized Box Cox Transformation with 250 nonmissing obs.:
 Estimated statistics:
 - lambda = 0.3254863 
 - mean (before standardization) = -0.3659267 
 - sd (before standardization) = 0.9807881 </code></pre>
</div>
<p>Another option to improve estimation efficiency is to use the
built-in parallelization functionality. The repeated CV process can be
parallelized via the argument and the <a
href="https://cran.r-project.org/package=parallel">parallel</a> and <a
href="https://cran.r-project.org/package=doRNG">doRNG</a> <span
class="citation" data-cites="doRNG">(<a href="#ref-doRNG"
role="doc-biblioref">Gaujoux 2020</a>)</span> packages. A cluster can be
set up with and passed to via the argument.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>cl</span> <span class='op'>&lt;-</span> <span class='fu'>parallel</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/parallel/makeCluster.html'>makeCluster</a></span><span class='op'>(</span><span class='fl'>5</span><span class='op'>)</span>
<span class='va'>b</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://petersonr.github.io/bestNormalize/reference/bestNormalize.html'>bestNormalize</a></span><span class='op'>(</span><span class='va'>x</span>, cluster <span class='op'>=</span> <span class='va'>cl</span>, r <span class='op'>=</span> <span class='fl'>10</span>, quiet <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
<span class='fu'>parallel</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/parallel/makeCluster.html'>stopCluster</a></span><span class='op'>(</span><span class='va'>cl</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>The amount by which this parallelization will speed up the estimation
of out-of-sample estimates depends (for the most part) on the number of
repeats, the number of cores, and the sample size of the vector to be
normalized. The plot below shows the estimation time for a run of with
15 repeats of 10-fold CV on a gamma-distributed random variable with
various sample sizes and numbers of cores.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:paralleltimings"></span>
<img src="figs/parallel_timings.pdf" alt="Potential speedup using parallelization functionality." width="100%" />
<p class="caption">
Figure 8: Potential speedup using parallelization
functionality.
</p>
</div>
</div>
<h2 id="implementation-with-caret-recipes">Implementation with caret,
recipes</h2>
<p>The and the functions can be utilized in conjunction with the <a
href="#">recipes</a> package to preprocess data in machine learning
workflows with <a
href="https://cran.r-project.org/package=tidymodels">tidymodels</a>
<span class="citation" data-cites="tidymodels">(<a
href="#ref-tidymodels" role="doc-biblioref">Kuhn and Wickham
2020</a>)</span> or in combination with <a href="#">caret</a>. The basic
usage within <a href="#">recipes</a> is shown below; for implementation
with <a href="#">caret</a>, refer to this paper’s application.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>rec</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://recipes.tidymodels.org/reference/recipe.html'>recipe</a></span><span class='op'>(</span> <span class='op'>~</span> <span class='va'>.</span>, data <span class='op'>=</span> <span class='va'>iris</span><span class='op'>)</span>  <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>                       <span class='co'># Initialize recipe</span>
  <span class='fu'><a href='https://petersonr.github.io/bestNormalize/reference/step_best_normalize.html'>step_best_normalize</a></span><span class='op'>(</span><span class='fu'><a href='https://recipes.tidymodels.org/reference/has_role.html'>all_predictors</a></span><span class='op'>(</span><span class='op'>)</span>, <span class='op'>-</span><span class='fu'><a href='https://recipes.tidymodels.org/reference/has_role.html'>all_nominal</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='co'># Transform predictors</span>
  <span class='fu'><a href='https://recipes.tidymodels.org/reference/prep.html'>prep</a></span><span class='op'>(</span><span class='va'>iris</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>                                            <span class='co'># Prep (train) recipe</span>
  <span class='fu'><a href='https://recipes.tidymodels.org/reference/bake.html'>bake</a></span><span class='op'>(</span><span class='va'>iris</span><span class='op'>)</span>                                                <span class='co'># Bake (apply) recipe</span>
</code></pre>
</div>
</div>
<p>Options can be supplied to to speed up or alter performance via the
argument, which passes a list of options to .</p>
<h2 id="additional-customization">Additional customization</h2>
<p>Two important means of customization are available: 1) users may add
custom transformation functions to be assessed alongside the default
suite of normalization methods, and 2) users may change the statistic
used “under the hood” by to estimate the departure from normality of the
transformed data. This section contains examples and guidance for both
extensions.</p>
<h3 id="adding-user-defined-functions">1) Adding user-defined
functions</h3>
<p>Via the argument, users can use ’s machinery to compare custom,
user-defined transformation functions to those included in the package.
Below, I consider an example where a user may wish to compare the
cube-root function with those provided in the package. requires two
functions to implement this: the transformation function and an
associated method. The custom cube-root transformation shown below is
simple, but its skeleton can readily be made arbitrarily more
complex.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>## Define custom function</span>
<span class='va'>cuberoot_x</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>...</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='va'>x.t</span> <span class='op'>&lt;-</span> <span class='op'>(</span><span class='va'>x</span><span class='op'>)</span><span class='op'>^</span><span class='op'>(</span><span class='fl'>1</span><span class='op'>/</span><span class='fl'>3</span><span class='op'>)</span>
  
  <span class='co'># Get in-sample normality statistic results</span>
  <span class='va'>ptest</span> <span class='op'>&lt;-</span> <span class='fu'>nortest</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/nortest/man/pearson.test.html'>pearson.test</a></span><span class='op'>(</span><span class='va'>x.t</span><span class='op'>)</span>
  
  <span class='va'>val</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
    x.t <span class='op'>=</span> <span class='va'>x.t</span>,
    x <span class='op'>=</span> <span class='va'>x</span>,
    n <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>x.t</span><span class='op'>)</span> <span class='op'>-</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span><span class='op'>)</span>, 
    norm_stat <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/unname.html'>unname</a></span><span class='op'>(</span><span class='va'>ptest</span><span class='op'>$</span><span class='va'>statistic</span> <span class='op'>/</span> <span class='va'>ptest</span><span class='op'>$</span><span class='va'>df</span><span class='op'>)</span>
  <span class='op'>)</span>
  
  <span class='co'># Assign class, return</span>
  <span class='fu'><a href='https://rdrr.io/r/base/class.html'>class</a></span><span class='op'>(</span><span class='va'>val</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>'cuberoot_x'</span><span class='op'>)</span>
  <span class='va'>val</span>
<span class='op'>}</span>

<span class='co'># S3 method that is used to apply the transformation to newly observed data</span>
<span class='va'>predict.cuberoot_x</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>object</span>, <span class='va'>newdata</span> <span class='op'>=</span> <span class='cn'>NULL</span>, <span class='va'>inverse</span> <span class='op'>=</span> <span class='cn'>FALSE</span>, <span class='va'>...</span><span class='op'>)</span> <span class='op'>{</span>
  
  <span class='co'># If no data supplied and not inverse</span>
  <span class='kw'>if</span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/NULL.html'>is.null</a></span><span class='op'>(</span><span class='va'>newdata</span><span class='op'>)</span> <span class='op'>&amp;</span> <span class='op'>!</span><span class='va'>inverse</span><span class='op'>)</span>
    <span class='va'>newdata</span> <span class='op'>&lt;-</span> <span class='va'>object</span><span class='op'>$</span><span class='va'>x</span>
  
  <span class='co'># If no data supplied and inverse transformation is requested</span>
  <span class='kw'>if</span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/NULL.html'>is.null</a></span><span class='op'>(</span><span class='va'>newdata</span><span class='op'>)</span> <span class='op'>&amp;</span> <span class='va'>inverse</span><span class='op'>)</span>
    <span class='va'>newdata</span> <span class='op'>&lt;-</span> <span class='va'>object</span><span class='op'>$</span><span class='va'>x.t</span>
  
  <span class='co'># Perform inverse transformation</span>
  <span class='kw'>if</span> <span class='op'>(</span><span class='va'>inverse</span><span class='op'>)</span> <span class='op'>{</span>
    <span class='co'># Reverse-cube-root (cube)</span>
    <span class='va'>val</span> <span class='op'>&lt;-</span>  <span class='va'>newdata</span><span class='op'>^</span><span class='fl'>3</span>
    
    <span class='co'># Otherwise, perform transformation as estimated</span>
  <span class='op'>}</span> <span class='kw'>else</span> <span class='kw'>if</span> <span class='op'>(</span><span class='op'>!</span><span class='va'>inverse</span><span class='op'>)</span> <span class='op'>{</span>
    <span class='va'>val</span> <span class='op'>&lt;-</span> <span class='op'>(</span><span class='va'>newdata</span><span class='op'>)</span><span class='op'>^</span><span class='op'>(</span><span class='fl'>1</span><span class='op'>/</span><span class='fl'>3</span><span class='op'>)</span>
  <span class='op'>}</span>
  
  <span class='co'># Return transformed data</span>
  <span class='fu'><a href='https://rdrr.io/r/base/unname.html'>unname</a></span><span class='op'>(</span><span class='va'>val</span><span class='op'>)</span>
<span class='op'>}</span>

<span class='co'>## Optional: print S3 method</span>
<span class='va'>print.cuberoot_x</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>...</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='fu'><a href='https://rdrr.io/r/base/cat.html'>cat</a></span><span class='op'>(</span><span class='st'>'cuberoot(x) Transformation with'</span>, <span class='va'>x</span><span class='op'>$</span><span class='va'>n</span>, <span class='st'>'nonmissing obs.\n'</span><span class='op'>)</span>
<span class='op'>}</span>
</code></pre>
</div>
</div>
<p>These functions can then be passed as a named list to :</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>custom_transform</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
  cuberoot_x <span class='op'>=</span> <span class='va'>cuberoot_x</span>,
  predict.cuberoot_x <span class='op'>=</span> <span class='va'>predict.cuberoot_x</span>,
  print.cuberoot_x <span class='op'>=</span> <span class='va'>print.cuberoot_x</span>
<span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>123129</span><span class='op'>)</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/GammaDist.html'>rgamma</a></span><span class='op'>(</span><span class='fl'>100</span>, <span class='fl'>1</span>, <span class='fl'>1</span><span class='op'>)</span>
<span class='op'>(</span><span class='va'>b</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://petersonr.github.io/bestNormalize/reference/bestNormalize.html'>bestNormalize</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, new_transforms <span class='op'>=</span> <span class='va'>custom_transform</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>Best Normalizing transformation with 100 Observations
 Estimated Normality Statistics (Pearson P / df, lower =&gt; more normal):
 - arcsinh(x): 1.2347
 - Box-Cox: 1.0267
 - Center+scale: 2.0027
 - cuberoot_x: NA
 - Exp(x): 4.7947
 - Log_b(x+a): 1.3547
 - orderNorm (ORQ): 1.1627
 - sqrt(x + a): 1.0907
 - Yeo-Johnson: 1.0987
Estimation method: Out-of-sample via CV with 10 folds and 5 repeats
 
Based off these, bestNormalize chose:
Standardized Box Cox Transformation with 100 nonmissing obs.:
 Estimated statistics:
 - lambda = 0.3281193 
 - mean (before standardization) = -0.1263882 
 - sd (before standardization) = 0.9913552 </code></pre>
</div>
<p>Evidently, the cube-root was the best normalizing transformation for
this gamma-distributed random variable, performing comparably to the
Box-Cox transformation.</p>
<h3 id="re-defining-normality">2) Re-defining normality</h3>
<p>The question “what is normal?” outside of a statistical discussion is
quite loaded and subjective. Even in statistical discussions, many
authors have contributed to the question of how to best detect
departures from normality; these solutions are diverse, and several have
been implemented well in <a href="#">nortest</a> already. In order to
accommodate those with varying opinions on the best definition of
normality, we have included a feature that allows users to specify a
custom definition of a normality statistic. This customization can be
accomplished via the argument, which takes a function that will then be
applied in lieu of the Pearson test statistic divided by its degree of
freedom to assess normality.</p>
<p>The user-defined function must take an argument , which indicates the
data on which a user wants to evaluate the statistic.</p>
<p>Here is an example using the Lilliefors (Kolmogorov-Smirnov)
normality test statistic:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://petersonr.github.io/bestNormalize/reference/bestNormalize.html'>bestNormalize</a></span><span class='op'>(</span><span class='va'>x</span>, norm_stat_fn <span class='op'>=</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='fu'>nortest</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/nortest/man/lillie.test.html'>lillie.test</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span><span class='op'>$</span><span class='va'>stat</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>Best Normalizing transformation with 100 Observations
 Estimated Normality Statistics (using custom normalization statistic)
 - arcsinh(x): 0.1958
 - Box-Cox: 0.1785
 - Center+scale: 0.2219
 - Exp(x): 0.3299
 - Log_b(x+a): 0.1959
 - orderNorm (ORQ): 0.186
 - sqrt(x + a): 0.1829
 - Yeo-Johnson: 0.1872
Estimation method: Out-of-sample via CV with 10 folds and 5 repeats
 
Based off these, bestNormalize chose:
Standardized Box Cox Transformation with 100 nonmissing obs.:
 Estimated statistics:
 - lambda = 0.3281193 
 - mean (before standardization) = -0.1263882 
 - sd (before standardization) = 0.9913552 </code></pre>
</div>
<p>Here is an example using the Lillifors (Kolmogorov-Smirnov) normality
test’s -value:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='op'>(</span><span class='va'>dont_do_this</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://petersonr.github.io/bestNormalize/reference/bestNormalize.html'>bestNormalize</a></span><span class='op'>(</span><span class='va'>x</span>, norm_stat_fn <span class='op'>=</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='fu'>nortest</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/nortest/man/lillie.test.html'>lillie.test</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span><span class='op'>$</span><span class='va'>p</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>Best Normalizing transformation with 100 Observations
 Estimated Normality Statistics (using custom normalization statistic)
 - arcsinh(x): 0.4327
 - Box-Cox: 0.4831
 - Center+scale: 0.2958
 - Exp(x): 0.0675
 - Log_b(x+a): 0.3589
 - orderNorm (ORQ): 0.4492
 - sqrt(x + a): 0.4899
 - Yeo-Johnson: 0.4531
Estimation method: Out-of-sample via CV with 10 folds and 5 repeats
 
Based off these, bestNormalize chose:
Standardized exp(x) Transformation with 100 nonmissing obs.:
 Relevant statistics:
 - mean (before standardization) = 6.885396 
 - sd (before standardization) = 13.66084 </code></pre>
</div>
<p>Note: will attempt to minimize this statistic by default, which is
definitely not what you want to do when calculating the -value. This is
seen in the example above, where the <strong>worst</strong>
normalization transformation, exponentiation, is chosen. In this case, a
user is advised to either manually select the best one or reverse their
defined normalization statistic (in this case by subtracting it from
1):</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>best_transform</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/which.min.html'>which.max</a></span><span class='op'>(</span><span class='va'>dont_do_this</span><span class='op'>$</span><span class='va'>norm_stats</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>do_this</span> <span class='op'>&lt;-</span> <span class='va'>dont_do_this</span><span class='op'>$</span><span class='va'>other_transforms</span><span class='op'>[[</span><span class='va'>best_transform</span><span class='op'>]</span><span class='op'>]</span>
<span class='va'>or_this</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://petersonr.github.io/bestNormalize/reference/bestNormalize.html'>bestNormalize</a></span><span class='op'>(</span><span class='va'>x</span>, norm_stat_fn <span class='op'>=</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='fl'>1</span><span class='op'>-</span><span class='fu'>nortest</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/nortest/man/lillie.test.html'>lillie.test</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span><span class='op'>$</span><span class='va'>p</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>A -value for normality should not be routinely used as the sole
selector of a normalizing transformation. A normality test’s -value, as
a measure of the departure from normality, is confounded by the sample
size (a high sample size may yield strong evidence of a practically
insignificant departure from normality). Therefore, we suggest the
statistic used should estimate the departure from normality rather the
strength of evidence against normality <span class="citation"
data-cites="normality">(e.g., <a href="#ref-normality"
role="doc-biblioref">Royston 1991</a>)</span>.</p>
<h1 id="application-to-autotrader-data">Application to Autotrader
data</h1>
<h2 id="background">Background</h2>
<p>The data set was scraped from the <a
href="https://www.autotrader.com/">autotrader website</a> as part of
this package (and because at the time of data collection in 2017, the
package author needed to purchase a car). We apply the <a
href="#">bestNormalize</a> functionality to de-skew mileage, age, and
price in a pricing model. See for more information on this data set.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='st'>"autotrader"</span><span class='op'>)</span>
<span class='va'>autotrader</span><span class='op'>$</span><span class='va'>yearsold</span> <span class='op'>&lt;-</span> <span class='fl'>2017</span> <span class='op'>-</span> <span class='va'>autotrader</span><span class='op'>$</span><span class='va'>Year</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<table class="table table-striped table-condensed" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-10">Table 1: </span>Sample characteristics of <code>autotrader</code>
data.
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
Overall (N=6,283)
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Make
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
<ul>
<li>Acura
</td>
<td style="text-align:left;">
185 (2.9%)
</td>
</tr>
<tr>
<td style="text-align:left;">
<ul>
<li>Buick
</td>
<td style="text-align:left;">
252 (4.0%)
</td>
</tr>
<tr>
<td style="text-align:left;">
<ul>
<li>Chevrolet
</td>
<td style="text-align:left;">
1,257 (20.0%)
</td>
</tr>
<tr>
<td style="text-align:left;">
<ul>
<li>GMC
</td>
<td style="text-align:left;">
492 (7.8%)
</td>
</tr>
<tr>
<td style="text-align:left;">
<ul>
<li>Honda
</td>
<td style="text-align:left;">
1,029 (16.4%)
</td>
</tr>
<tr>
<td style="text-align:left;">
<ul>
<li>Hyundai
</td>
<td style="text-align:left;">
381 (6.1%)
</td>
</tr>
<tr>
<td style="text-align:left;">
<ul>
<li>Mazda
</td>
<td style="text-align:left;">
272 (4.3%)
</td>
</tr>
<tr>
<td style="text-align:left;">
<ul>
<li>Nissan
</td>
<td style="text-align:left;">
735 (11.7%)
</td>
</tr>
<tr>
<td style="text-align:left;">
<ul>
<li>Pontiac
</td>
<td style="text-align:left;">
63 (1.0%)
</td>
</tr>
<tr>
<td style="text-align:left;">
<ul>
<li>Toyota
</td>
<td style="text-align:left;">
1,202 (19.1%)
</td>
</tr>
<tr>
<td style="text-align:left;">
<ul>
<li>Volkswagen
</td>
<td style="text-align:left;">
415 (6.6%)
</td>
</tr>
<tr>
<td style="text-align:left;">
Price ($)
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
<ul>
<li>Mean (SD)
</td>
<td style="text-align:left;">
17,145 (8,346)
</td>
</tr>
<tr>
<td style="text-align:left;">
<ul>
<li>Range
</td>
<td style="text-align:left;">
722 - 64,998
</td>
</tr>
<tr>
<td style="text-align:left;">
Mileage
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
<ul>
<li>Mean (SD)
</td>
<td style="text-align:left;">
63,638 (49,125)
</td>
</tr>
<tr>
<td style="text-align:left;">
<ul>
<li>Range
</td>
<td style="text-align:left;">
2 - 325,556
</td>
</tr>
<tr>
<td style="text-align:left;">
Year
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
<ul>
<li>Mean (SD)
</td>
<td style="text-align:left;">
2011.9 (3.5)
</td>
</tr>
<tr>
<td style="text-align:left;">
<ul>
<li>Range
</td>
<td style="text-align:left;">
2000.0 - 2016.0
</td>
</tr>
<tr>
<td style="text-align:left;">
Age (years old)
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
<ul>
<li>Mean (SD)
</td>
<td style="text-align:left;">
5.1 (3.5)
</td>
</tr>
<tr>
<td style="text-align:left;">
<ul>
<li>Range
</td>
<td style="text-align:left;">
1.0 - 17.0
</td>
</tr>
</tbody>
</table></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul>
</div>
<h2 id="transform-both-sides-regression">Transform-both-sides
regression</h2>
<p>Transform-both-sides (TBS) regression has several benefits that have
been explored thoroughly elsewhere (see <span class="citation"
data-cites="harrell">Harrell (<a href="#ref-harrell"
role="doc-biblioref">2015</a>)</span> for an overview). Importantly, TBS
regression can often (though not always) yield models that better
satisfy assumptions of linear regression and mitigate the influence of
outliers/skew. This approach has been shown to be useful in shrinking
the size of prediction intervals while maintaining closer to nominal
coverage in this data set <span class="citation"
data-cites="orq_paper">(<a href="#ref-orq_paper"
role="doc-biblioref">Peterson and Cavanaugh 2019</a>)</span>.</p>
<p>First, we will normalize the outcome (price).</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='op'>(</span><span class='va'>priceBN</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://petersonr.github.io/bestNormalize/reference/bestNormalize.html'>bestNormalize</a></span><span class='op'>(</span><span class='va'>autotrader</span><span class='op'>$</span><span class='va'>price</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>Best Normalizing transformation with 6283 Observations
 Estimated Normality Statistics (Pearson P / df, lower =&gt; more normal):
 - arcsinh(x): 3.8573
 - Box-Cox: 2.2291
 - Center+scale: 3.5532
 - Log_b(x+a): 3.8573
 - orderNorm (ORQ): 1.1384
 - sqrt(x + a): 2.1977
 - Yeo-Johnson: 2.2291
Estimation method: Out-of-sample via CV with 10 folds and 5 repeats
 
Based off these, bestNormalize chose:
orderNorm Transformation with 6283 nonmissing obs and ties
 - 2465 unique values 
 - Original quantiles:
   0%   25%   50%   75%  100% 
  722 11499 15998 21497 64998 </code></pre>
</div>
<p>We can see that the estimated normality statistic for the ORQ
transformation is close to 1, so we know it is performing quite well
despite the ties in the data. It is also performing considerably better
than all of the other transformations.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='op'>(</span><span class='va'>mileageBN</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://petersonr.github.io/bestNormalize/reference/bestNormalize.html'>bestNormalize</a></span><span class='op'>(</span><span class='va'>autotrader</span><span class='op'>$</span><span class='va'>mileage</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>Best Normalizing transformation with 6283 Observations
 Estimated Normality Statistics (Pearson P / df, lower =&gt; more normal):
 - arcsinh(x): 3.4332
 - Box-Cox: 3.0903
 - Center+scale: 14.7488
 - Log_b(x+a): 3.4354
 - orderNorm (ORQ): 1.1514
 - sqrt(x + a): 5.1041
 - Yeo-Johnson: 3.0891
Estimation method: Out-of-sample via CV with 10 folds and 5 repeats
 
Based off these, bestNormalize chose:
orderNorm Transformation with 6283 nonmissing obs and ties
 - 6077 unique values 
 - Original quantiles:
    0%    25%    50%    75%   100% 
     2  29099  44800  88950 325556 </code></pre>
</div>
<p>Similarly, the ORQ normalization performed best for mileage.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='op'>(</span><span class='va'>yearsoldBN</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://petersonr.github.io/bestNormalize/reference/bestNormalize.html'>bestNormalize</a></span><span class='op'>(</span><span class='va'>autotrader</span><span class='op'>$</span><span class='va'>yearsold</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>Best Normalizing transformation with 6283 Observations
 Estimated Normality Statistics (Pearson P / df, lower =&gt; more normal):
 - arcsinh(x): 83.2706
 - Box-Cox: 83.2909
 - Center+scale: 83.4324
 - Exp(x): 574.3318
 - Log_b(x+a): 83.0756
 - orderNorm (ORQ): 81.3615
 - sqrt(x + a): 83.4373
 - Yeo-Johnson: 84.0028
Estimation method: Out-of-sample via CV with 10 folds and 5 repeats
 
Based off these, bestNormalize chose:
orderNorm Transformation with 6283 nonmissing obs and ties
 - 17 unique values 
 - Original quantiles:
  0%  25%  50%  75% 100% 
   1    3    4    7   17 </code></pre>
</div>
<p>For age, we see something peculiar; none of the normalizing
transformations performed well according to the normality statistics. By
plotting the data, it becomes evident that the frequency of ties in age
makes it very difficult to find a normalizing transformation (see figure
below). Even so, is chosen as it has the lowest estimated <span
class="math inline">\(P/DF\)</span> statistic.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:histapp"></span>
<img src="figs/histapp-1.png" alt="Distributions of car variables before and after normalization." width="4.2in" height="2.1in" />
<p class="caption">
Figure 9: Distributions of car variables before and after
normalization.
</p>
</div>
</div>
<p>Next, we will fit a linear model on the transformed values of each
variable for our TBS regression. The reverse-transformation functions
will allow us to visualize how these variables affect model predictions
in terms of their original units.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>p.t</span> <span class='op'>&lt;-</span> <span class='va'>priceBN</span><span class='op'>$</span><span class='va'>x.t</span>; <span class='va'>m.t</span> <span class='op'>&lt;-</span> <span class='va'>mileageBN</span><span class='op'>$</span><span class='va'>x.t</span>; <span class='va'>yo.t</span> <span class='op'>&lt;-</span> <span class='va'>yearsoldBN</span><span class='op'>$</span><span class='va'>x.t</span>
<span class='va'>fit</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/lm.html'>lm</a></span><span class='op'>(</span><span class='va'>p.t</span> <span class='op'>~</span> <span class='va'>m.t</span> <span class='op'>+</span> <span class='va'>yo.t</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-11">Table 2: </span>TBS regression results for autotrader data.
</caption>
<thead>
<tr>
<th style="text-align:left;">
Variable
</th>
<th style="text-align:right;">
Estimate
</th>
<th style="text-align:right;">
Std. Error
</th>
<th style="text-align:right;">
t value
</th>
<th style="text-align:right;">
Pr(&gt;|t|)
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Intercept
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:right;">
0.010
</td>
<td style="text-align:right;">
0.553
</td>
<td style="text-align:right;">
0.58
</td>
</tr>
<tr>
<td style="text-align:left;">
g(Mileage)
</td>
<td style="text-align:right;">
-0.234
</td>
<td style="text-align:right;">
0.016
</td>
<td style="text-align:right;">
-14.966
</td>
<td style="text-align:right;">
&lt; 0.001
</td>
</tr>
<tr>
<td style="text-align:left;">
g(Age)
</td>
<td style="text-align:right;">
-0.441
</td>
<td style="text-align:right;">
0.016
</td>
<td style="text-align:right;">
-27.134
</td>
<td style="text-align:right;">
&lt; 0.001
</td>
</tr>
</tbody>
</table>
</div>
<p>Unsurprisingly, we find that there are very significant relationships
between transformed car price, mileage, and age. However, to interpret
these values, we must resort to visualizations since there is no
inherent meaning of a “one-unit increase” in the ORQ normalized
measurements. We utilize the <a
href="https://cran.r-project.org/package=visreg">visreg</a> package
<span class="citation" data-cites="visreg">(<a href="#ref-visreg"
role="doc-biblioref">Breheny and Burchett 2017</a>)</span> to perform
our visualizations, using in conjunction with <a href="#">visreg</a>’s
and options to view the relationship in terms of the original unit for
the response and covariate respectively (formatting omitted).<a
href="#">bestNormalize</a> For the sake of illustration, we have also
plotted the estimated effect of a generalized additive (spline) model
fit with <a href="https://cran.r-project.org/package=mgcv">mgcv</a>
<span class="citation" data-cites="mgcv">(<a href="#ref-mgcv"
role="doc-biblioref">Wood 2011</a>)</span>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='http://pbreheny.github.io/visreg/reference/visreg.html'>visreg</a></span><span class='op'>(</span><span class='va'>fit</span>, <span class='st'>"m.t"</span><span class='op'>)</span>
<span class='fu'><a href='http://pbreheny.github.io/visreg/reference/visreg.html'>visreg</a></span><span class='op'>(</span><span class='va'>fit</span>, <span class='st'>"m.t"</span>, 
       partial <span class='op'>=</span> <span class='cn'>TRUE</span>,
       trans <span class='op'>=</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>price.t</span><span class='op'>)</span> 
         <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>priceBN</span>, newdata <span class='op'>=</span> <span class='va'>price.t</span>, inverse <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>/</span><span class='fl'>1000</span>, 
       xtrans <span class='op'>=</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>mileage.t</span><span class='op'>)</span> 
         <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>mileageBN</span>, newdata <span class='op'>=</span> <span class='va'>mileage.t</span>, inverse <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
       <span class='op'>)</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:linearvisreg"></span>
<img src="figs/linearvisreg-1.png" alt="TBS regression visualized on transformed units (left) and original units (right)." width="80%" />
<p class="caption">
Figure 10: TBS regression visualized on transformed units (left)
and original units (right).
</p>
</div>
</div>
<p>Below, we visualize the age effect, demonstrating how one might
visualize the effect outside of <a href="#">visreg</a> (plot formatting
is omitted).</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Set up data for plotting line</span>
<span class='va'>new_yo</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>min</a></span><span class='op'>(</span><span class='va'>autotrader</span><span class='op'>$</span><span class='va'>yearsold</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span><span class='va'>autotrader</span><span class='op'>$</span><span class='va'>yearsold</span><span class='op'>)</span>, len <span class='op'>=</span> <span class='fl'>100</span><span class='op'>)</span>
<span class='va'>newX</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>yearsold <span class='op'>=</span> <span class='va'>new_yo</span>, mileage <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/median.html'>median</a></span><span class='op'>(</span><span class='va'>autotrader</span><span class='op'>$</span><span class='va'>mileage</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>newXt</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>yo.t <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>yearsoldBN</span>, <span class='va'>newX</span><span class='op'>$</span><span class='va'>yearsold</span><span class='op'>)</span>, 
                    m.t <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>mileageBN</span>, <span class='va'>newX</span><span class='op'>$</span><span class='va'>mileage</span><span class='op'>)</span><span class='op'>)</span>

<span class='va'>line_vals_t</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>fit</span>, newdata <span class='op'>=</span> <span class='va'>newXt</span><span class='op'>)</span> <span class='co'># Calculate line (transformed)</span>
<span class='va'>line_vals</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>priceBN</span>, newdata <span class='op'>=</span> <span class='va'>line_vals_t</span>, inverse <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>autotrader</span><span class='op'>$</span><span class='va'>yearsold</span>, <span class='va'>autotrader</span><span class='op'>$</span><span class='va'>price</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/lines.html'>lines</a></span><span class='op'>(</span><span class='va'>new_yo</span>, <span class='va'>line_vals</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:gam-tbs-model"></span>
<img src="figs/gam-tbs-model-1.png" alt="Age effect on car price (re-transformed to original unit)." width="80%" />
<p class="caption">
Figure 11: Age effect on car price (re-transformed to original
unit).
</p>
</div>
</div>
<h2 id="implementation-with-recipes">Implementation with recipes</h2>
<p>To build a predictive model for the price variable that uses each
vehicle’s model and make in addition to its mileage and age, we can
utilize the <a href="#">caret</a> and <a href="#">recipes</a>
functionality to do so. This section outlines how to use <a
href="#">bestNormalize</a> in conjunction with these other popular ML
packages. Price is logged instead of ORQ transformed in order to
facilitate the interpretation of measures for prediction accuracy.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://tidymodels.tidymodels.org'>tidymodels</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/topepo/caret/'>caret</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/tidymodels/recipes'>recipes</a></span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>321</span><span class='op'>)</span>
<span class='va'>df_split</span> <span class='op'>&lt;-</span> <span class='fu'>initial_split</span><span class='op'>(</span><span class='va'>autotrader</span>, prop <span class='op'>=</span> <span class='fl'>.9</span><span class='op'>)</span>
<span class='va'>df_train</span> <span class='op'>&lt;-</span> <span class='fu'>training</span><span class='op'>(</span><span class='va'>df_split</span><span class='op'>)</span>
<span class='va'>df_test</span> <span class='op'>&lt;-</span> <span class='fu'>testing</span><span class='op'>(</span><span class='va'>df_split</span><span class='op'>)</span>

<span class='va'>rec</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://recipes.tidymodels.org/reference/recipe.html'>recipe</a></span><span class='op'>(</span><span class='va'>price</span> <span class='op'>~</span> <span class='va'>Make</span> <span class='op'>+</span> <span class='va'>model</span> <span class='op'>+</span>  <span class='va'>mileage</span> <span class='op'>+</span> <span class='va'>status</span> <span class='op'>+</span> <span class='va'>Year</span>, <span class='va'>df_train</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://recipes.tidymodels.org/reference/step_mutate.html'>step_mutate</a></span><span class='op'>(</span>years_old <span class='op'>=</span> <span class='fl'>2017</span> <span class='op'>-</span> <span class='va'>Year</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://recipes.tidymodels.org/reference/step_rm.html'>step_rm</a></span><span class='op'>(</span><span class='va'>Year</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://recipes.tidymodels.org/reference/step_log.html'>step_log</a></span><span class='op'>(</span><span class='va'>price</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://petersonr.github.io/bestNormalize/reference/step_best_normalize.html'>step_best_normalize</a></span><span class='op'>(</span><span class='fu'><a href='https://recipes.tidymodels.org/reference/has_role.html'>all_predictors</a></span><span class='op'>(</span><span class='op'>)</span>, <span class='op'>-</span><span class='fu'><a href='https://recipes.tidymodels.org/reference/has_role.html'>all_nominal</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://recipes.tidymodels.org/reference/step_other.html'>step_other</a></span><span class='op'>(</span><span class='fu'><a href='https://recipes.tidymodels.org/reference/has_role.html'>all_nominal</a></span><span class='op'>(</span><span class='op'>)</span>, threshold <span class='op'>=</span> <span class='fl'>10</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://recipes.tidymodels.org/reference/step_dummy.html'>step_dummy</a></span><span class='op'>(</span><span class='fu'><a href='https://recipes.tidymodels.org/reference/has_role.html'>all_nominal</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://recipes.tidymodels.org/reference/prep.html'>prep</a></span><span class='op'>(</span><span class='op'>)</span>

<span class='va'>fit1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caret/man/train.html'>train</a></span><span class='op'>(</span><span class='va'>price</span> <span class='op'>~</span> <span class='va'>.</span>, <span class='fu'><a href='https://recipes.tidymodels.org/reference/bake.html'>bake</a></span><span class='op'>(</span><span class='va'>rec</span>, <span class='cn'>NULL</span><span class='op'>)</span>, method <span class='op'>=</span> <span class='st'>'glmnet'</span><span class='op'>)</span>
<span class='va'>fit2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caret/man/train.html'>train</a></span><span class='op'>(</span><span class='va'>price</span> <span class='op'>~</span> <span class='va'>.</span>, <span class='fu'><a href='https://recipes.tidymodels.org/reference/bake.html'>bake</a></span><span class='op'>(</span><span class='va'>rec</span>, <span class='cn'>NULL</span><span class='op'>)</span>, method <span class='op'>=</span> <span class='st'>'earth'</span><span class='op'>)</span>
<span class='va'>fit3</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caret/man/train.html'>train</a></span><span class='op'>(</span><span class='va'>price</span> <span class='op'>~</span> <span class='va'>.</span>, <span class='fu'><a href='https://recipes.tidymodels.org/reference/bake.html'>bake</a></span><span class='op'>(</span><span class='va'>rec</span>, <span class='cn'>NULL</span><span class='op'>)</span>, method <span class='op'>=</span> <span class='st'>'rf'</span><span class='op'>)</span>

<span class='va'>r</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caret/man/resamples.html'>resamples</a></span><span class='op'>(</span><span class='va'>fits</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>glmnet <span class='op'>=</span> <span class='va'>fit1</span>, earth <span class='op'>=</span> <span class='va'>fit2</span>, rf <span class='op'>=</span> <span class='va'>fit3</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>r</span><span class='op'>)</span> <span class='co'># Extra-sample CV results</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-14">Table 3: </span>CV prediction accuracy of various ML methods.
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
Min.
</th>
<th style="text-align:right;">
1st Qu.
</th>
<th style="text-align:right;">
Median
</th>
<th style="text-align:right;">
Mean
</th>
<th style="text-align:right;">
3rd Qu.
</th>
<th style="text-align:right;">
Max.
</th>
<th style="text-align:right;">
NA’s
</th>
</tr>
</thead>
<tbody>
<tr grouplength="3">
<td colspan="8" style="border-bottom: 1px solid;">
<strong>MAE</strong>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
glmnet
</td>
<td style="text-align:right;">
0.181
</td>
<td style="text-align:right;">
0.184
</td>
<td style="text-align:right;">
0.186
</td>
<td style="text-align:right;">
0.189
</td>
<td style="text-align:right;">
0.194
</td>
<td style="text-align:right;">
0.198
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
earth
</td>
<td style="text-align:right;">
0.147
</td>
<td style="text-align:right;">
0.151
</td>
<td style="text-align:right;">
0.154
</td>
<td style="text-align:right;">
0.155
</td>
<td style="text-align:right;">
0.158
</td>
<td style="text-align:right;">
0.163
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
rf
</td>
<td style="text-align:right;">
0.136
</td>
<td style="text-align:right;">
0.141
</td>
<td style="text-align:right;">
0.143
</td>
<td style="text-align:right;">
0.144
</td>
<td style="text-align:right;">
0.147
</td>
<td style="text-align:right;">
0.157
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr grouplength="3">
<td colspan="8" style="border-bottom: 1px solid;">
<strong>RMSE</strong>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
glmnet
</td>
<td style="text-align:right;">
0.242
</td>
<td style="text-align:right;">
0.247
</td>
<td style="text-align:right;">
0.252
</td>
<td style="text-align:right;">
0.256
</td>
<td style="text-align:right;">
0.264
</td>
<td style="text-align:right;">
0.276
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
earth
</td>
<td style="text-align:right;">
0.203
</td>
<td style="text-align:right;">
0.209
</td>
<td style="text-align:right;">
0.214
</td>
<td style="text-align:right;">
0.217
</td>
<td style="text-align:right;">
0.226
</td>
<td style="text-align:right;">
0.235
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
rf
</td>
<td style="text-align:right;">
0.193
</td>
<td style="text-align:right;">
0.208
</td>
<td style="text-align:right;">
0.213
</td>
<td style="text-align:right;">
0.210
</td>
<td style="text-align:right;">
0.215
</td>
<td style="text-align:right;">
0.217
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr grouplength="3">
<td colspan="8" style="border-bottom: 1px solid;">
<strong>RSQ</strong>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
glmnet
</td>
<td style="text-align:right;">
0.767
</td>
<td style="text-align:right;">
0.772
</td>
<td style="text-align:right;">
0.785
</td>
<td style="text-align:right;">
0.782
</td>
<td style="text-align:right;">
0.789
</td>
<td style="text-align:right;">
0.801
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
earth
</td>
<td style="text-align:right;">
0.807
</td>
<td style="text-align:right;">
0.833
</td>
<td style="text-align:right;">
0.845
</td>
<td style="text-align:right;">
0.842
</td>
<td style="text-align:right;">
0.855
</td>
<td style="text-align:right;">
0.864
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
rf
</td>
<td style="text-align:right;">
0.835
</td>
<td style="text-align:right;">
0.845
</td>
<td style="text-align:right;">
0.855
</td>
<td style="text-align:right;">
0.854
</td>
<td style="text-align:right;">
0.860
</td>
<td style="text-align:right;">
0.873
</td>
<td style="text-align:right;">
0
</td>
</tr>
</tbody>
</table>
</div>
<p>Evidently, the random forest generally performed better in
cross-validated prediction metrics, achieving a higher R-squared (RSQ),
lower root-mean-squared error (RMSE), and lower mean absolute error
(MAE). Since price was logged, RMSE and MAE are on the log scale. For
the test set, we calculate these quantities in price’s original unit
(2017 US dollars) using the <a
href="https://cran.r-project.org/package=yardstick">yardstick</a>
package <span class="citation" data-cites="yardstick">(<a
href="#ref-yardstick" role="doc-biblioref">Kuhn and Vaughan
2020</a>)</span>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Out of sample prediction accuracy</span>
<span class='va'>results</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span><span class='op'>(</span><span class='va'>fits</span>, <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='va'>p</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>x</span>, newdata <span class='op'>=</span> <span class='fu'><a href='https://recipes.tidymodels.org/reference/bake.html'>bake</a></span><span class='op'>(</span><span class='va'>rec</span>, <span class='va'>df_test</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
  <span class='fu'>yardstick</span><span class='fu'>::</span><span class='fu'>metrics</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>est <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='va'>p</span><span class='op'>)</span>, truth <span class='op'>=</span> <span class='va'>df_test</span><span class='op'>$</span><span class='va'>price</span><span class='op'>)</span>, 
                     truth <span class='op'>=</span> <span class='va'>truth</span>, estimate <span class='op'>=</span> <span class='va'>est</span><span class='op'>)</span>
<span class='op'>}</span><span class='op'>)</span>
<span class='va'>results</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-16">Table 4: </span>Test data prediction accuracy of various ML
methods. RMSE and MAE can be interpreted in terms of 2017 US dollars.
</caption>
<thead>
<tr>
<th style="text-align:left;">
Method
</th>
<th style="text-align:right;">
RMSE
</th>
<th style="text-align:right;">
RSQ
</th>
<th style="text-align:right;">
MAE
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
glmnet
</td>
<td style="text-align:right;">
4076
</td>
<td style="text-align:right;">
0.772
</td>
<td style="text-align:right;">
2847
</td>
</tr>
<tr>
<td style="text-align:left;">
earth
</td>
<td style="text-align:right;">
3619
</td>
<td style="text-align:right;">
0.814
</td>
<td style="text-align:right;">
2500
</td>
</tr>
<tr>
<td style="text-align:left;">
rf
</td>
<td style="text-align:right;">
3257
</td>
<td style="text-align:right;">
0.853
</td>
<td style="text-align:right;">
2294
</td>
</tr>
</tbody>
</table>
</div>
<p>After normalization of mileage and age, a random forest had the
optimal predictive performance on car price given a car’s make, model,
age, and mileage compared to other ML models, achieving out-of-sample
R-squared 0.853 on a left-out test data set. We conjecture that the
random forest performs best because it can better capture differential
depreciation by make and model than the other methods.</p>
<h1 id="discussion">Discussion</h1>
<p>We have shown how the <a href="#">bestNormalize</a> package can
effectively and efficiently find the best normalizing transformation for
a vector or set of vectors. However, normalization is by no means
something that should be applied universally and without motivation. In
situations where units have meaning, normalizing prior to analysis can
contaminate the relationships suspected in the data and/or reduce
predictive accuracy. Further, depending on the type of transformations
used, interpreting regression coefficients post-transformation can be
difficult or impossible without using a figure since the transformation
function itself will look completely different for different
distributions. So, while normalization transformations may well be able
to increase the robustness of results and mitigate violations to the
classical linear regression assumption of Gaussian residuals, it is by
no means a universal solution.</p>
<p>On the other hand, when hypotheses are exploratory or when data is of
poor quality with high amounts of skew/outliers, normalization can be an
effective means of mitigating downstream issues this can cause in the
analyses. For example, in machine learning contexts, some predictor
manipulations rely on second-order statistics (e.g., principal
components analysis or partial least squares), for which the variance
calculation can be sensitive to skew and outliers. Normalizing
transformations can improve the quality and stability of these
calculations. Similarly, predictor normalization reduces the tendency
for high-leverage points to have their leverage propagated into
engineered features such as interactions or polynomials. Ultimately,
these benefits can often produce predictive models that are more robust
and stable.</p>
<p>We focused on making this package useful in a variety of machine
learning workflows. We are enthusiastic in our support of <a
href="#">bestNormalize</a>, and will continue to maintain the package
while it is found to be useful by R users. We hope to continue to build
up the repertoire of candidate transformations using the same
infrastructure so that additional ones can be considered by default in
the future.</p>
<h1 id="references">References</h1>
<div class="sourceCode" id="cb15"><pre
class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<h2 class="appendix" id="cran-packages-used">CRAN packages used</h2>
<p><a
href="https://cran.r-project.org/package=bestNormalize">bestNormalize</a>,
<a href="https://cran.r-project.org/package=caret">caret</a>, <a
href="https://cran.r-project.org/package=recipes">recipes</a>, <a
href="https://cran.r-project.org/package=MASS">MASS</a>, <a
href="https://cran.r-project.org/package=LambertW">LambertW</a>, <a
href="https://cran.r-project.org/package=nortest">nortest</a>, <a
href="https://cran.r-project.org/package=parallel">parallel</a>, <a
href="https://cran.r-project.org/package=doRNG">doRNG</a>, <a
href="https://cran.r-project.org/package=tidymodels">tidymodels</a>, <a
href="https://cran.r-project.org/package=visreg">visreg</a>, <a
href="https://cran.r-project.org/package=scales">scales</a>, <a
href="https://cran.r-project.org/package=ggplot2">ggplot2</a>, <a
href="https://cran.r-project.org/package=mgcv">mgcv</a>, <a
href="https://cran.r-project.org/package=yardstick">yardstick</a></p>
<h2 class="appendix" id="cran-task-views-implied-by-cited-packages">CRAN
Task Views implied by cited packages</h2>
<p><a
href="https://cran.r-project.org/view=SocialSciences">SocialSciences</a>,
<a
href="https://cran.r-project.org/view=Distributions">Distributions</a>,
<a href="https://cran.r-project.org/view=Econometrics">Econometrics</a>,
<a
href="https://cran.r-project.org/view=Environmetrics">Environmetrics</a>,
<a
href="https://cran.r-project.org/view=HighPerformanceComputing">HighPerformanceComputing</a>,
<a href="https://cran.r-project.org/view=Multivariate">Multivariate</a>,
<a
href="https://cran.r-project.org/view=TeachingStatistics">TeachingStatistics</a>,
<a href="https://cran.r-project.org/view=Bayesian">Bayesian</a>, <a
href="https://cran.r-project.org/view=Graphics">Graphics</a>, <a
href="https://cran.r-project.org/view=MachineLearning">MachineLearning</a>,
<a
href="https://cran.r-project.org/view=NumericalMathematics">NumericalMathematics</a>,
<a
href="https://cran.r-project.org/view=Phylogenetics">Phylogenetics</a>,
<a
href="https://cran.r-project.org/view=Psychometrics">Psychometrics</a>,
<a href="https://cran.r-project.org/view=Robust">Robust</a></p>
<div id="refs" class="references csl-bib-body hanging-indent"
role="doc-bibliography">
<div id="ref-bartlett1947" class="csl-entry" role="doc-biblioentry">
M. S. Bartlett. The use of transformations. <em>Biometrics</em>, 3(1):
39–52, 1947. URL <a
href="https://doi.org/10.2307/3001536">https://doi.org/10.2307/3001536</a>.
</div>
<div id="ref-BickelDoksum" class="csl-entry" role="doc-biblioentry">
P. J. Bickel and K. A. Doksum. An analysis of transformations revisited.
<em>Journal of the American Statistical Association</em>, 76(374):
296–311, 1981. URL <a
href="https://doi.org/10.1080/01621459.1981.10477649">https://doi.org/10.1080/01621459.1981.10477649</a>.
</div>
<div id="ref-BoxCox1964" class="csl-entry" role="doc-biblioentry">
G. E. P. Box and D. R. Cox. An analysis of transformations. <em>Journal
of the Royal Statistical Society. Series B (Methodological)</em>, 26(2):
211–252, 1964. URL <a
href="https://doi.org/10.2307/2984418">https://doi.org/10.2307/2984418</a>.
</div>
<div id="ref-visreg" class="csl-entry" role="doc-biblioentry">
P. Breheny and W. Burchett. Visualization of regression models using
visreg. <em>The R Journal</em>, 9(2): 56–71, 2017.
</div>
<div id="ref-d1986goodness" class="csl-entry" role="doc-biblioentry">
R. B. D’Agostino. <em>Goodness-of-fit-techniques.</em> CRC press, 1986.
</div>
<div id="ref-doRNG" class="csl-entry" role="doc-biblioentry">
R. Gaujoux. <em>doRNG: Generic reproducible parallel backend for
’foreach’ loops.</em> 2020. URL <a
href="https://CRAN.R-project.org/package=doRNG">https://CRAN.R-project.org/package=doRNG</a>.
R package version 1.8.2.
</div>
<div id="ref-goerg2011" class="csl-entry" role="doc-biblioentry">
G. M. Goerg. Lambert w random variables-a new family of generalized
skewed distributions with applications to risk estimation. <em>The
Annals of Applied Statistics</em>, 5(3): 2197–2230, 2011. URL <a
href="https://doi.org/10.1214/11-AOAS457">https://doi.org/10.1214/11-AOAS457</a>.
</div>
<div id="ref-nortest" class="csl-entry" role="doc-biblioentry">
J. Gross and U. Ligges. <em>Nortest: Tests for normality.</em> 2015. URL
<a
href="https://CRAN.R-project.org/package=nortest">https://CRAN.R-project.org/package=nortest</a>.
R package version 1.0-4.
</div>
<div id="ref-harrell" class="csl-entry" role="doc-biblioentry">
F. E. Harrell. <em>Regression modeling strategies: With applications to
linear models, logistic and ordinal regression, and survival
analysis.</em> Springer, 2015.
</div>
<div id="ref-JohnDraper" class="csl-entry" role="doc-biblioentry">
J. A. John and N. R. Draper. An alternative family of transformations.
<em>Journal of the Royal Statistical Society. Series C (Applied
Statistics)</em>, 29(2): 190–197, 1980. URL <a
href="https://doi.org/10.2307/2986305">https://doi.org/10.2307/2986305</a>.
</div>
<div id="ref-caret" class="csl-entry" role="doc-biblioentry">
M. Kuhn. <em>Caret: Classification and regression training.</em> 2017.
URL <a
href="https://CRAN.R-project.org/package=caret">https://CRAN.R-project.org/package=caret</a>.
R package version 6.0-78.
</div>
<div id="ref-kuhn2013APM" class="csl-entry" role="doc-biblioentry">
M. Kuhn and K. Johnson. <em>Applied predictive modeling.</em> Springer,
2013. URL <a
href="https://doi.org/10.1007/978-1-4614-6849-3">https://doi.org/10.1007/978-1-4614-6849-3</a>.
</div>
<div id="ref-yardstick" class="csl-entry" role="doc-biblioentry">
M. Kuhn and D. Vaughan. <em>Yardstick: Tidy characterizations of model
performance.</em> 2020. URL <a
href="https://CRAN.R-project.org/package=yardstick">https://CRAN.R-project.org/package=yardstick</a>.
R package version 0.0.7.
</div>
<div id="ref-recipes" class="csl-entry" role="doc-biblioentry">
M. Kuhn and H. Wickham. <em>Recipes: Preprocessing tools to create
design matrices.</em> 2018. URL <a
href="https://CRAN.R-project.org/package=recipes">https://CRAN.R-project.org/package=recipes</a>.
R package version 0.1.2.
</div>
<div id="ref-tidymodels" class="csl-entry" role="doc-biblioentry">
M. Kuhn and H. Wickham. <em>Tidymodels: Easily install and load the
’tidymodels’ packages.</em> 2020. URL <a
href="https://CRAN.R-project.org/package=tidymodels">https://CRAN.R-project.org/package=tidymodels</a>.
R package version 0.1.0.
</div>
<div id="ref-Manly" class="csl-entry" role="doc-biblioentry">
B. F. J. Manly. Exponential data transformations. <em>Journal of the
Royal Statistical Society. Series D (The Statistician)</em>, 25(1):
37–42, 1976. URL <a
href="https://doi.org/10.2307/2988129">https://doi.org/10.2307/2988129</a>.
</div>
<div id="ref-orq_paper" class="csl-entry" role="doc-biblioentry">
R. A. Peterson and J. E. Cavanaugh. Ordered quantile normalization: A
semiparametric transformation built for the cross-validation era.
<em>Journal of Applied Statistics</em>, 1–16, 2019. URL <a
href="https://doi.org/10.1080/02664763.2019.1630372">https://doi.org/10.1080/02664763.2019.1630372</a>.
</div>
<div id="ref-normality" class="csl-entry" role="doc-biblioentry">
P. Royston. Estimating departure from normality. <em>Statistics in
Medicine</em>, 10(8): 1283–1293, 1991. URL <a
href="https://onlinelibrary.wiley.com/doi/abs/10.1002/sim.4780100811">https://onlinelibrary.wiley.com/doi/abs/10.1002/sim.4780100811</a>.
</div>
<div id="ref-thode2002testing" class="csl-entry" role="doc-biblioentry">
H. C. Thode. <em>Testing for normality.</em> CRC press, 2002.
</div>
<div id="ref-van1952" class="csl-entry" role="doc-biblioentry">
B. Van der Waerden. Order tests for the two-sample problem and their
power. In <em>Indagationes mathematicae (proceedings)</em>, pages.
453–458 1952. Elsevier.
</div>
<div id="ref-MASS" class="csl-entry" role="doc-biblioentry">
W. N. Venables and B. D. Ripley. <em>Modern applied statistics with
s.</em> Fourth New York: Springer, 2002. URL <a
href="http://www.stats.ox.ac.uk/pub/MASS4">http://www.stats.ox.ac.uk/pub/MASS4</a>.
ISBN 0-387-95457-0.
</div>
<div id="ref-mgcv" class="csl-entry" role="doc-biblioentry">
S. N. Wood. Fast stable restricted maximum likelihood and marginal
likelihood estimation of semiparametric generalized linear models.
<em>Journal of the Royal Statistical Society (B)</em>, 73(1): 3–36,
2011.
</div>
</div>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom">
  <h3 id="references">References</h3>
  <div id="references-listing"></div>
  <h3 id="reuse">Reuse</h3>
  <p>Text and figures are licensed under Creative Commons Attribution <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>. The figures that have been reused from other sources don't fall under this license and can be recognized by a note in their caption: "Figure from ...".</p>
  <h3 id="citation">Citation</h3>
  <p>For attribution, please cite this work as</p>
  <pre class="citation-appendix short">Peterson, "The R Journal: Finding Optimal Normalizing Transformations via bestNormalize", {The R Journal}, 2021</pre>
  <p>BibTeX citation</p>
  <pre class="citation-appendix long">@article{RJ-2021-041,
  author = {Peterson, Ryan A.},
  title = {The R Journal: Finding Optimal Normalizing Transformations via bestNormalize},
  journal = {{The R Journal}},
  year = {2021},
  note = {https://doi.org/10.32614/RJ-2021-041},
  doi = {10.32614/RJ-2021-041},
  volume = {13},
  issue = {1},
  issn = {2073-4859},
  pages = {310-329}
}</pre>
</div>
<!--/radix_placeholder_appendices-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<!--radix_placeholder_navigation_after_body--><html><body>
<div class="distill-site-nav distill-site-footer">
<p>© The R Foundation, <a href="mailto:r-journal@r-project.org">web page
contact</a>.</p>
</div>
<!--/radix_placeholder_navigation_after_body-->
</body></html>


</body>

</html>
