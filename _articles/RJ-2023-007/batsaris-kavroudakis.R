# Generated by `rjournal_pdf_article()` using `knitr::purl()`: do not edit by hand
# Please edit batsaris-kavroudakis.Rmd to modify this file

## ----setup, include=FALSE-----------------------------------------------------
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
library(areal)
library(sf)
library(classInt)
library(RColorBrewer)
library(maptools)
library(microbenchmark)
library(rjtools)



## ----include=TRUE, echo=TRUE, eval=FALSE--------------------------------------
#> 
#> # CRAN installation
#> install.packages("populR")
#> 
#> # Github installation
#> devtools::install_github("mbatsaris/populR")
#> 


## ----methods, out.width = "100%", fig.cap = "Illustration of the populR package's functionality. populR uses two areal interpolation methods to convert population values from city block polygons (left) to a set of individual building polygons (center). AWI (top) solely relies on the area of intersection between blocks and buildings (top-right). VWI (bottom) uses the area of intersection between blocks and buildings multiplied by the height or number of floors to aid the transformation process (bottom-right).", fig.alt="An image to graphically explain awi and vwi methods."----
knitr::include_graphics("img/methods.png")


## ----include=TRUE, echo=TRUE, eval=FALSE--------------------------------------
#> 
#> # attach package
#> library(populR)
#> 
#> # load data
#> data('src')
#> data('trg')
#> 
#> # downscaling using awi
#> awi <- pp_estimate(target = trg, source = src, spop = pop, sid = sid,
#> method = awi)
#> 


## ----include=TRUE, echo=TRUE, eval=FALSE--------------------------------------
#> 
#> # downscaling using vwi
#> vwi <- pp_estimate(target = trg, source = src, spop = pop, sid = sid,
#> volume = floors, method = vwi)
#> 


## ----include=TRUE, echo=TRUE, eval=FALSE--------------------------------------
#> 
#> # downscaling using awi
#> awi <- pp_round(x = awi, tpop = pp_est, spop = pop, sid = sid)
#> 
#> # downscaling using awi
#> vwi <- pp_round(x = vwi, tpop = pp_est, spop = pop, sid = sid)
#> 


## ----include=TRUE, echo=TRUE, eval=FALSE--------------------------------------
#> 
#> # attach library
#> library(dplyr)
#> 
#> # group estimated and actual values by source identification number - awi
#> src_awi <- awi %>%
#>   group_by(sid) %>%
#>   summarise(est = sum(pp_est), act = unique(pop))
#> 
#> # awi approach compare to source values
#> pp_compare(x = src_awi, estimated = est, actual = act, title = "awi vs source")
#> 
#> # group estimated and actual values by source identification number - vwi
#> src_vwi <- vwi %>%
#>   group_by(sid) %>%
#>   summarise(est = sum(pp_est), act = unique(pop))
#> 
#> # vwi approach compare to source values
#> pp_compare(x = src_vwi, estimated = est, actual = act, title = "vwi vs source")
#> 
#> 


## ----studyarea, out.width = "100%", fig.cap = "Part of the city of Mytilini used as the case study for numerical experiments. The study area is represented by 9 city blocks and 179 buildings (in orange). The study area counts 911 residents.", fig.alt="An image of a small part of the city of Mytilini used as the case study. The image shows city block and building polygons."----
knitr::include_graphics("img/study_area.png")


## ----include=FALSE, echo=FALSE------------------------------------------------
t1 <- data.frame(
  Title = c('City block population counts', 'City blocks', 'Buildings'),
  Format = c('Tabular', 'Spatial', 'Spatial'),
  Source = c('Hellenic Statistical Authority', 'Hellenic Statistical Authority', 'Hellenic Statistical Authority'),
  Year = c('2011', '2011', '2011')
)



## ----dtbl-html, eval = knitr::is_html_output(), layout = "c-body-outset"------
#> 
#> knitr::kable(t1, align = 'c', format = "html", caption = "Data used for numerical experiments") %>%
#>   kableExtra::kable_styling(position = "center")
#> 


## ----dtbl-ltx, eval = knitr::is_latex_output()--------------------------------

knitr::kable(t1, format = "latex", caption = "Data used for numerical experiments") %>% 
  kableExtra::kable_styling(font_size = 7)



## ----include=TRUE, echo=TRUE, eval=TRUE---------------------------------------

# attach libraries
library(populR)
library(areal)
library(sf)

# load data
data("trg", package = "populR")
data("src", package = "populR")

# populR - awi
awi <- pp_estimate(target = trg, source = src, spop = pop, sid = sid,
method = awi)

# populR - vwi
vwi <- pp_estimate(target = trg, source = src, spop = pop, sid = sid,
volume = floors, method = vwi)

# areal - sum weights
aws <- aw_interpolate(trg, tid = tid, source = src, sid = 'sid',
weight = 'sum', output = 'sf', extensive = 'pop')

# areal - total weights
awt <- aw_interpolate(trg, tid = tid, source = src, sid = 'sid',
weight = 'total', output = 'sf', extensive = 'pop')

# sf - total weights
sf <- st_interpolate_aw(src['pop'], trg, extensive = TRUE)




## ----include=FALSE, echo=FALSE, eval=TRUE-------------------------------------
colnames(aws)[colnames(aws) == 'pop'] <- 'pp_est'
colnames(awt)[colnames(awt) == 'pop'] <- 'pp_est'
colnames(sf)[colnames(sf) == 'pop'] <- 'pp_est'

awi <- awi[order(awi$tid),]
vwi <- vwi[order(vwi$tid),]
data <- data.frame(
  nr = 1:nrow(awi),
  rf = round(awi$rf, digits = 2),
  awi = round(awi$pp_est, digits = 2),
  vwi = round(vwi$pp_est, digits = 2),
  aws = round(aws$pp_est, digits = 2),
  awt = round(awt$pp_est, digits = 2),
  sf = round(sf$pp_est, digits = 2))




## ----rtbl-html, eval = knitr::is_html_output(), layout = "c-body-outset"------
#> 
#> knitr::kable(data[1:10, c(1,3:7)], format = "html", caption = "Implementation results obtained by awi, vwi, awt, aws and sf for 10 buildings of the study area.") %>%
#>   kableExtra::kable_styling(position = "center")
#> 


## ----rtbl-ltx, eval = knitr::is_latex_output()--------------------------------

knitr::kable(data[1:10, c(1,3:7)], format = "latex", caption = "Implementation results obtained by awi, vwi, awt, aws and sf for 10 buildings of the study area.") %>% 
  kableExtra::kable_styling(font_size = 7)



## ----maps, out.width = "49%", out.height="20%", fig.show='hold', fig.cap = "Cartographic representation of the downscaling results acquired by a) awt (top-left), b) sf (top-right), c) awi (center-left), d) aws (center-right), and e) vwi (bottom). awt and sf use the same formula therefore, they provide similar results. Additionally, the same results obtained by aws and awi as they are based on the same formula. vwi provide somehow different distribution because of the influence of the volume weights during the interpolation process.", fig.alt="An image of 5 maps. One for each method presented in this article."----
knitr::include_graphics(c("img/result_maps/map_awt.png", "img/result_maps/map_sf.png", "img/result_maps/map_awi.png", "img/result_maps/map_aws.png", "img/result_maps/map_vwi.png"))





## ----include=TRUE, echo=TRUE, eval=FALSE--------------------------------------
#> 
#> # compare awi to rf
#> pp_compare(data, estimated = awi, actual = rf, title = "awi vs rf")
#> 
#> # compare vwi to rf
#> pp_compare(data, estimated = vwi, actual = rf, title = "vwi vs rf")
#> 
#> # compare sf to rf
#> pp_compare(data, estimated = sf, actual = rf, title = "sf vs rf")
#> 
#> # compare awt to rf
#> pp_compare(data, estimated = awt, actual = rf, title = "awt vs rf")
#> 
#> # compare aws to rf
#> pp_compare(data, estimated = aws, actual = rf, title = "aws vs rf")
#> 


## ----2rtbl-html, eval = knitr::is_html_output(), layout = "c-body-outset"-----
#> 
#> knitr::kable(data[1:10, ], format = "html", caption = "Implementation results obtained by awi, vwi, awt, aws and sf for 10 buildings of the study area in comparison to reference data (rf).") %>%
#>   kableExtra::kable_styling(position = "center")
#> 


## ----2rtbl-ltx, eval = knitr::is_latex_output()-------------------------------

knitr::kable(data[1:10, ], format = "latex", caption = "Implementation results obtained by awi, vwi, awt, aws and sf for 10 buildings of the study area in comparison to reference data (rf).") %>% 
  kableExtra::kable_styling(font_size = 7)



## ----include=FALSE, echo=FALSE, eval=TRUE-------------------------------------

err <- data.frame(
  Title = c('rf vs vwi', 'rf vs awi', 'rf vs aws', 'rf vs sf', 'rf vs awt'),
  RMSE = c(1.45, 5.33, 5.33, 7.42, 7.42),
  MAE = c(0.94, 2.75, 2.75, 3.66, 3.66),
  R = c(0.988, 0.822, 0.822, 0.804, 0.804)
)

names(err)[4] <- 'R^2^'



## ----ertbl-html, eval = knitr::is_html_output(), layout = "c-body-outset"-----
#> 
#> knitr::kable(err, format = "html", caption = "RMSE, MAE and R^2^ values were calculated to assess the estimation accuracy using rf as the control variable. vwi provide the best measurements.", escape = F) %>%
#>   kableExtra::kable_styling(position = "center")
#> 


## ----ertbl-ltx, eval = knitr::is_latex_output()-------------------------------

knitr::kable(err, col.names = c('Title', 'RMSE', 'MAE', 'R\\textsuperscript{2}'), escape = FALSE, format = "latex", caption = "RMSE, MAE and R\\textsuperscript{2} values were calculated to assess the estimation accuracy using rf as the control variable. vwi provide the best measurements.") %>% 
  kableExtra::kable_styling(font_size = 7)



## ----scatterplots-ltx, eval = knitr::is_latex_output(), out.width = "49%", fig.show="hold", fig.cap = "Investigation of the relationship of the outcomes and reference data (rf) as the control variable. a) rf vs awt, R\\textsuperscript{2} = 0.804 (top-left), b) rf vs sf, R\\textsuperscript{2} = 0.804 (top-right), c) rf vs aws, R\\textsuperscript{2} = 0.822 (center-left), d) rf vs awi, R\\textsuperscript{2} = 0.822 (center-right) and e) rf vs vwi, R\\textsuperscript{2} = 0.988.", fig.alt="An image of five scatter plots produced by the pp\\_compare function."----
knitr::include_graphics(c("img/result_figs/rf_vs_awt.png", "img/result_figs/rf_vs_sf.png", "img/result_figs/rf_vs_aws.png",
                        "img/result_figs/rf_vs_awi.png", "img/result_figs/rf_vs_vwi.png"))


## ----scatterplots, eval = knitr::is_html_output(), out.width = "49%", fig.show="hold", fig.cap = "Investigation of the relationship of the outcomes and reference data (rf) as the control variable. a) rf vs awt, R^2^ = 0.804 (top-left), b) rf vs sf, R^2^ = 0.804 (top-right), c) rf vs aws, R^2^ = 0.822 (center-left), d) rf vs awi, R^2^ = 0.822 (center-right) and e) rf vs vwi, R^2^ = 0.988.", fig.alt="An image of five scatter plots produced by the pp\\_compare function.", fig.alt="An image of five scatter plots produced by the pp\\_compare function."----
#> knitr::include_graphics(c("img/result_figs/rf_vs_awt.png", "img/result_figs/rf_vs_sf.png", "img/result_figs/rf_vs_aws.png",
#>                         "img/result_figs/rf_vs_awi.png", "img/result_figs/rf_vs_vwi.png"))


## ----include=FALSE, echo=FALSE, eval=TRUE-------------------------------------

bidp <- data.frame(
  Name = c('vwi', 'awi', 'aws',  'awt', 'sf'),
  Min = c(74.06, 74.31, 128.48, 172.08, 136.48),
  Mean = c(76.23, 75.91, 132.56, 176.27, 142.33),
  Max = c(84.39, 99.70, 143.97, 185.86, 289.38)
)

chdp <- data.frame(
  Name = c('vwi', 'awi', 'aws',  'awt', 'sf'),
  Min = c(1.55, 1.55, 2.26, 2.27, 2.63),
  Mean = c(1.67, 1.68, 2.39, 2.42, 2.79),
  Max = c(1.94, 1.95, 2.64, 2.62, 3.17)
)



## ----bidp-html, eval = knitr::is_html_output(), layout = "c-body-outset"------
#> 
#> knitr::kable(bidp, format = "html", caption = "Execution time measurement comparisons (in milliseconds) using microbenchmark and sample data") %>%
#>   kableExtra::kable_styling(position = "center")
#> 


## ----bidp-ltx, eval = knitr::is_latex_output()--------------------------------

knitr::kable(bidp, format = "latex", caption = "Execution time measurement comparisons (in milliseconds) using microbenchmark and sample data") %>% 
  kableExtra::kable_styling(font_size = 7)



## ----chdp-html, eval = knitr::is_html_output(), layout = "c-body-outset"------
#> 
#> knitr::kable(chdp, format = "html", caption = "Execution time measurement comparisons (in seconds) using microbenchmark and external
#> data") %>%
#>   kableExtra::kable_styling(position = "center")
#> 


## ----chdp-ltx, eval = knitr::is_latex_output()--------------------------------

knitr::kable(chdp, format = "latex", caption = "Execution time measurement comparisons (in seconds) using microbenchmark and external
data") %>% 
  kableExtra::kable_styling(font_size = 7)


